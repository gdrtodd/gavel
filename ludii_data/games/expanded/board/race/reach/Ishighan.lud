(game "Ishighan" (players 4) (equipment {(board (spiral turns:5 sites:86) {(track "Track" {86 85 84 83 82 81 80 79 78 77 76 75 74 73 72 71 70 69 68 67 66 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 0} directed:True)} use:Vertex) (dice d:2 from:0 num:4) (map "Throw" {(pair 0 20) (pair 1 5) (pair 2 0) (pair 3 9) (pair 4 80)}) (piece "Stick" Each (if (= (trackSite Move "Track" steps:(mapEntry "Throw" (count Pips))) -1) (move (from (from) level:(level)) (to 0) (then (if (= 1 (value Player Mover)) (forEach Site (sites Track "Track" from:(last From) to:(last To)) (forEach Level (site) FromTop (if (= (what at:(site) level:(level)) (id "Hyena" Neutral)) (set Value Mover 2))))))) (move (from (from) level:(level)) (to (trackSite Move "Track" steps:(mapEntry "Throw" (count Pips))) if:True) (then (if (= 1 (value Player Mover)) (forEach Site (sites Track "Track" from:(last From) to:(last To)) (forEach Level (site) FromTop (if (= (what at:(site) level:(level)) (id "Hyena" Neutral)) (set Value Mover 2)))))))) maxState:85) (piece "Hyena" Neutral) (hand P1)}) (rules (start {(place Stack items:{"Stick4" "Stick3" "Stick2" "Stick1"} (handSite P1)) (place Stack "Hyena0" (handSite P1))}) (play (do (roll) next:(if (= 0 (where "Stick" Mover)) (if (!= (mapEntry "Throw" (count Pips)) 0) (move (from (if (!= (where "Hyena" Neutral) -1) (where "Hyena" Neutral) (handSite P1)) level:(where Level "Hyena" Neutral at:(if (!= (where "Hyena" Neutral) -1) (where "Hyena" Neutral) (handSite P1)))) (to (trackSite Move from:(if (!= (where "Hyena" Neutral) -1) (where "Hyena" Neutral) (handSite P1)) "Track" steps:(mapEntry "Throw" (count Pips)))) (then (if (= (last To) 0) (forEach Site (sites Track "Track" from:(last From) to:(last To)) (if (!= (site) (last To)) (forEach Level (site) FromTop (remove (site) level:(level))))) (forEach Site (sites Track "Track" from:(last From) to:(last To)) (if (!= (site) (last To)) (forEach Level (site) FromTop (fromTo (from (site) level:(level)) (to (last To) (apply (if (and (= 0 (state at:(site) level:(level))) (!= 0 (who at:(site) level:(level)))) (if (<= (site) (- (count Vertices) 1)) (set State at:(site) level:(level) (site))))))))))))) (move Pass (then (forEach Site (sites Board) (forEach Level (site) FromTop (if (!= 0 (state at:(site) level:(level))) (if (< 0 (value Player (who at:(site) level:(level)))) (remove (site) level:(level)) (fromTo (from (site) level:(level)) (to (state at:(site) level:(level)) (apply (and (set State at:(site) level:(level) 0) (set Value (player (who at:(site) level:(level))) 1)))))))))))) (if (!= (mapEntry "Throw" (count Pips)) 0) (or (forEach Piece) (forEach Piece container:1)) (move Pass (then (if (= 1 (value Player Mover)) (remove (where "Stick" Mover) level:(where Level "Stick" Neutral at:(where "Stick" Mover)))))))) (then (if (!= (mapEntry "Throw" (count Pips)) 0) (moveAgain))))) (end {(forEach Player if:(no Pieces Player) (result Player Loss)) (forEach Player if:(or (= (if (!= (where "Hyena" Neutral) -1) (where "Hyena" Neutral) (handSite P1)) 0) (and {(is Occupied 0) (>= 1 (count Sites in:(difference (sites Occupied by:All) (if (!= (where "Hyena" Neutral) -1) (where "Hyena" Neutral) (handSite P1))))) (= 1 (size Stack at:(if (!= (where "Hyena" Neutral) -1) (where "Hyena" Neutral) (handSite P1))))})) (result Player Win))}))) 