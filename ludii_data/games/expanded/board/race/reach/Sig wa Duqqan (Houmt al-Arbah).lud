(game "Sig wa Duqqan (Houmt al-Arbah)" (players 4) (equipment {(board (merge {(shift -4 0 (rectangle 1 4)) (square 4) (shift -4 3 (square 1))}) {(track "Track" "16,E,S1,W,S1,E,S1,W2" directed:True) (track "ExtensionTrack" "4,W" directed:True) (track "GhoulaTrack" "20,16,E,S1,W,S1,E,S1,W2" directed:True) (track "ReverseGhoulaTrack" "6,E,N1,W,N1,E,N1,W" directed:True)}) (piece "Ghoula" Neutral) (piece "Stick" Each (if (= (from) 6) (if (= (state at:(from) level:(level)) 8) (move (from (from) level:(level)) (to 4)) (if (= (mapEntry "Throw" (count Pips)) 1) (move Select (from (from) level:(level)) (then (set State at:(last To) level:(last LevelTo) (+ 1 (state at:(last To) level:(last LevelTo)))))))) (if (is In (from) (sites Track "Track")) (move (from (from) level:(level) if:(if (<= 1 (state at:(from) level:(level))) True (= (mapEntry "Throw" (count Pips)) 1))) (to (trackSite Move "Track" steps:(mapEntry "Throw" (count Pips))) if:True) (then (if (not (<= 1 (state at:(last To) level:(topLevel at:(last To))))) (set State at:(last To) level:(topLevel at:(last To)) 1)))) (if (is In (from) (sites Track "ExtensionTrack")) (or {(if (and (!= (from) 0) (= (mapEntry "Throw" (count Pips)) 1)) (move (from (from) level:(level)) (to (trackSite Move "ExtensionTrack" steps:1)))) (if (= (from) 0) (move Pass (then (and (if (= 0 (mapEntry "Throw" (count Pips))) (set Var 2) (set Var (mapEntry "Throw" (count Pips)))) (moveAgain)))) (if (= 3 (mapEntry "Throw" (count Pips))) (move Pass (then (and (set Var 3) (moveAgain))))))})))) maxState:8) (dice d:2 from:0 num:4) (map "Throw" {(pair 0 4) (pair 1 3) (pair 2 0) (pair 3 1) (pair 4 6)})}) (rules (start {(place Stack "Ghoula0" 20) (place Stack items:{"Stick4" "Stick3" "Stick2" "Stick1"} 16)}) (play (do (if (<= (var) 0) (roll)) next:(if (> (var) 0) (if (= 1 (size Stack at:(where "Ghoula" Neutral))) (move (from (where "Ghoula" Neutral) level:(where Level "Ghoula" Neutral at:(where "Ghoula" Neutral))) (to (trackSite Move from:(where "Ghoula" Neutral) "GhoulaTrack" steps:1))) (move (from (where "Ghoula" Neutral) level:(where Level "Ghoula" Neutral at:(where "Ghoula" Neutral))) (to (trackSite Move from:(where "Ghoula" Neutral) "ReverseGhoulaTrack" steps:1)) (then (if (= (last From) 17) (forEach Level (last From) FromTop (remove (last From) level:(level))) (forEach Level (last From) FromTop (fromTo (from (last From) level:(level)) (to (last To))))))) (then (if (and (= 1 (size Stack at:(where "Ghoula" Neutral))) (= 6 (where "Ghoula" Neutral))) (set Var 0) (and (if (> (var) 1) (moveAgain)) (set Var (- (var) 1)))))) (if (!= 0 (mapEntry "Throw" (count Pips))) (forEach Piece))) (then (if (is In (mapEntry "Throw" (count Pips)) (sites {1 6 4})) (moveAgain))))) (end {(forEach Player if:(no Pieces Player) (result Player Loss)) (forEach Player if:(and (= 1 (size Stack at:(where "Ghoula" Neutral))) (= 6 (where "Ghoula" Neutral))) (result Player Win))}))) 