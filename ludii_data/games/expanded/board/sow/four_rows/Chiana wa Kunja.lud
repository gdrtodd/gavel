(game "Chiana wa Kunja" (players 2) (equipment {(mancalaBoard 4 16 store:None (track "Track" "0,E,63,W" loop:True)) (piece "Seed" Each) (hand Shared)}) (rules (start {(place "Seed1" (sites Bottom) counts:{4}) (place "Seed2" (sites Top) counts:{4})}) (play (or (move Select (from (trackSite FirstSite from:(trackSite FirstSite if:(not (is Mover (who at:(to))))) if:(is Mover (who at:(to))))) (then (do (and (forEach Site (sites Track "Track" from:(last From) to:(trackSite Move from:(last From) steps:(count at:(last From)))) (if (!= (mover) (who at:(site))) (and (remove (site) count:(count at:(site))) (add (piece (id "Seed" Mover)) (to Cell (handSite Shared)) count:(count at:(site)))))) (set Var "NumSowed" (count at:(last From)))) next:(sow) (then (and {(if (< 1 (var "NumSowed")) (if (and (= 1 (count at:(trackSite Move from:(last From) "Track" steps:(var "NumSowed")))) (= 2 (count at:(trackSite Move from:(last From) "Track" steps:(- (var "NumSowed") 1))))) (moveAgain))) (if (!= 0 (what Cell at:(handSite Shared))) (fromTo (from Cell (handSite Shared)) (to (last From)) count:(count Cell at:(handSite Shared)))) (set Var "NumSowed" 0)}))))) (if (and (= 1 (count Pieces Mover)) (is Empty (trackSite Move from:(from) "Track" steps:1))) (move (from (trackSite FirstSite from:(trackSite FirstSite if:(not (is Mover (who at:(to))))) if:(is Mover (who at:(to))))) (to (trackSite Move from:(from) "Track" steps:2) (apply (and (remove (to) count:(count at:(to))) (add (piece (id "Seed" Mover)) (to (to)) count:(count at:(to)))))))))) (end (if (no Moves Next) (result Mover Win))))) 