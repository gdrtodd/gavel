(game "Intotoi" (players 2) (equipment {(mancalaBoard 2 12 store:None (track "Track" "0,E,N,W" loop:True)) (piece "Seed" Shared) (hand Each) (regions P1 (sites Bottom)) (regions P2 (sites Top))}) (rules (start (set Count 3 to:(sites {1 2 4 5 7 8 10 11 22 21 19 18 16 15 13 12}))) phases:{(phase "Opening1" (play (move Select (from 10) (then (sow count:2)))) (nextPhase "Opening2")) (phase "Opening2" (play (if (is Prev Mover) (move Select (from (sites {(last To afterConsequence:True)}) if:(> (count at:(from)) 0)) (then (sow apply:(if (!= 1 (count at:(to))) (moveAgain))))) (move Select (from (sites {13 15}) if:(> (count at:(from)) 0)) (then (sow count:2 apply:(if (!= 1 (count at:(to))) (moveAgain))))))) (nextPhase (not (is Next Mover)) "Play")) (phase "Play" (play (move Select (from (sites From (do (move Select (from (sites Mover) if:(> (count at:(from)) 0)) (then (sow))) ifAfterwards:(or (and (= 1 (count at:(last To afterConsequence:True))) (is In (last To afterConsequence:True) (sites Mover))) (is In (last To afterConsequence:True) (sites Next))))) if:(> (count at:(from)) 0)) (then (sow apply:(if (= 1 (count at:(to))) (if (and (is Occupied (if (is Mover P1) (+ (to) 12) (- (to) 12))) (is In (to) (sites Mover))) (fromTo (from (if (is Mover P1) (+ (to) 12) (- (to) 12))) (to (handSite Mover)) count:(count at:(if (is Mover P1) (+ (to) 12) (- (to) 12))))) (moveAgain)))))) (nextPhase Mover (is Next Mover) "Replay")) (phase "Replay" (play (move Select (from (sites {(last To afterConsequence:True)}) if:(> (count at:(from)) 0)) (then (sow apply:(if (= 1 (count at:(to))) (if (and (is Occupied (if (is Mover P1) (+ (to) 12) (- (to) 12))) (is In (to) (sites Mover))) (fromTo (from (if (is Mover P1) (+ (to) 12) (- (to) 12))) (to (handSite Mover)) count:(count at:(if (is Mover P1) (+ (to) 12) (- (to) 12))))) (moveAgain)))))) (nextPhase Mover (not (is Next Mover)) "Play"))} (end (if (no Moves Mover) (byScore {(score P1 (+ (count Cell at:(handSite P1)) (count in:(sites P1)))) (score P2 (+ (count Cell at:(handSite P2)) (count in:(sites P2))))}))))) 