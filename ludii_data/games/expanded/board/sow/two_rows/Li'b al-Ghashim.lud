(game "Li'b al-Ghashim" (players 2) (equipment {(mancalaBoard 2 6 store:None {(track "TrackCCW" "0,E,N,W" loop:True) (track "TrackCW" "5,W,N,E" loop:True)}) (piece "Seed" Shared) (hand Each) (regions P1 (sites Bottom)) (regions P2 (sites Top)) (map "RightMost" {(pair P1 5) (pair P2 6)})}) (rules (start (place "Seed" (handSite P1) count:72)) phases:{(phase "Opening1" (play (or {(if (is Occupied Cell (handSite P1)) (forEach Value min:1 max:(count Cell at:(handSite P1)) (move (from (handSite P1)) (to (sites Board)) count:(value))) (forEach Site (sites Board) (if (is Occupied (site)) (move (from (site)) (to (sites Board) if:(!= (to) (from)))))) (then (moveAgain))) (if (and (is Empty (handSite P1)) (all Sites (sites Board) if:(<= 4 (count at:(site))))) (move Pass))})) (nextPhase (was Pass) "Opening2")) (phase "Opening2" (play (or (move Pass (then (and (set Pending) (moveAgain)))) (move Swap Players P1 P2 (then (and (set NextPlayer (player 1)) (set Pending)))))) (nextPhase "Sowing")) (phase "Sowing" (play (if (and (not (is Prev Mover)) (all Sites (sites Next) if:(= 0 (count at:(site))))) (move (from (sites Mover) if:(is Occupied (from))) (to (trackSite FirstSite "TrackCW" from:(mapEntry "RightMost" Mover) if:(and (is In (to) (sites Mover)) (is Occupied (to)))))) (move Select (from (if (and (not (is Pending)) (is Prev Mover)) (sites {(var "Replay")}) (sites Mover)) if:(is Occupied (from))) (then (sow "TrackCCW" if:True apply:(if (is Odd (count at:(to))) (and (moveAgain) (set Var "Replay" (to))) (and (fromTo (from (to)) (to (handSite Mover)) count:(count at:(to))) (if (is Occupied (if (is In (to) (sites Bottom)) (+ (to) 6) (- (to) 6))) (fromTo (from (if (is In (to) (sites Bottom)) (+ (to) 6) (- (to) 6))) (to (handSite Mover)) count:(count at:(if (is In (to) (sites Bottom)) (+ (to) 6) (- (to) 6))))))) backtracking:(and (is Occupied (to)) (is Even (count at:(to))))))) (then (if (= 1 (count in:(sites Board))) (and {(if (< (count Cell at:(handSite P1)) (count Cell at:(handSite P2))) (addScore P2 (- (count Cell at:(handSite P2)) (count Cell at:(handSite P1)))) (addScore P1 (- (count Cell at:(handSite P1)) (count Cell at:(handSite P2))))) (if (is Occupied Cell (handSite P2)) (fromTo (from (handSite P2)) (to (handSite P1)) count:(count Cell at:(handSite P2)))) (forEach Site (sites Board) (if (is Occupied (site)) (fromTo (from (site)) (to Cell (handSite P1)) count:(count at:(site)))))}))))) (nextPhase (= 1 (count in:(sites Board))) "Opening1"))} (end (forEach Player if:(<= 60 (score Player)) (result Player Win))))) 