(game "Main Chongkak" (players 2) (equipment {(mancalaBoard 2 6 (track "Track" "0,ENE,E,ESE,WSW,W" loop:True)) (piece "Seed" Shared) (regions P1 (sites Bottom)) (regions P2 (sites Top)) (map {(pair P1 FirstSite) (pair P2 LastSite)}) (map "RightMost" {(pair P1 6) (pair P2 (+ 6 1))})}) (rules (start {(set RememberValue "Playable" (union (sites Top) (sites Bottom))) (set Count 6 to:(union (sites Bottom) (sites Top)))}) phases:{(phase "Sowing" (play (or {(move Select (from (if (and (not (is Pending)) (is Prev Mover)) (sites {(var "Replay")}) (sites Mover)) if:(and (is Occupied (from)) (is In (from) (sites (values Remembered "Playable"))))) (then (sow apply:(if (and (is In (to) (sites Mover)) (= 1 (count at:(to)))) (if (is Occupied (if (is Mover P1) (+ (to) 6) (- (to) 6))) (fromTo (from (if (is Mover P1) (+ (to) 6) (- (to) 6))) (to (mapEntry Mover)) count:(count at:(if (is Mover P1) (+ (to) 6) (- (to) 6))))) (if (= (to) (mapEntry Mover)) (and (set Pending) (moveAgain)) (if (and (< 1 (count at:(to))) (!= (to) (mapEntry Next))) (and (moveAgain) (set Var "Replay" (to)))))) skipIf:(and {(not (is In (to) (sites (values Remembered "Playable")))) (!= (to) (mapEntry P1)) (!= (to) (mapEntry P2))}))))} (then (if (or (all Sites (sites Bottom) if:(= 0 (count at:(site)))) (all Sites (sites Top) if:(= 0 (count at:(site))))) (and {(forEach Site (sites P1) (fromTo (from (site)) (to (mapEntry P1)) count:(count at:(site)))) (forEach Site (sites P2) (fromTo (from (site)) (to (mapEntry P2)) count:(count at:(site)))) (forget Value "Playable" All)}))))) (end (if (all Sites (union (sites Top) (sites Bottom)) if:(= 0 (count at:(site)))) {(if (> 6 (count at:(mapEntry P1))) (result P2 Win)) (if (> 6 (count at:(mapEntry P2))) (result P1 Win))})) (nextPhase (all Sites (union (sites Top) (sites Bottom)) if:(= 0 (count at:(site)))) "BetweenRounds")) (phase "BetweenRounds" (play (if (not (all Sites (sites Mover) if:(is Occupied (site)))) (if (<= 6 (count at:(mapEntry Mover))) (move (from (mapEntry Mover)) (to (trackSite FirstSite from:(mapEntry "RightMost" Mover) if:(is Empty (to)))) count:6 (then (remember Value "Playable" (last To))))))) (nextPhase (all Passed) "Sowing"))})) 