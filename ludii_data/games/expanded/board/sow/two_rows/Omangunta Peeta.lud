(game "Omangunta Peeta" (players 2) (equipment {(mancalaBoard 2 7 store:None (track "Track" "0,E,N,W" loop:True)) (regions P1 (sites Bottom)) (regions P2 (sites Top)) (piece "Seed" Shared) (hand Each)}) (rules (start {(set Count 6 to:(difference (sites Track) (sites Centre))) (set Count 1 to:(sites Centre)) (set RememberValue "Playable" (union (sites Top) (sites Bottom)))}) phases:{(phase "Sowing" (play (or {(move Select (from (if (is Prev Mover) (sites {(var "Replay")}) (difference (sites Mover) (sites Centre))) if:(and (is Occupied (from)) (is In (from) (sites (values Remembered "Playable"))))) (then (sow apply:(if (is Occupied (trackSite Move from:(to) "Track" steps:1)) (and (moveAgain) (set Var "Replay" (to))) (if (is In (trackSite Move from:(to) "Track" steps:2) (sites Centre)) (set Value Mover 1) (and (if (is Occupied (trackSite Move from:(to) "Track" steps:2)) (fromTo (from (trackSite Move from:(to) "Track" steps:2)) (to (handSite Mover)) count:(count at:(trackSite Move from:(to) "Track" steps:2)))) (if (is Occupied (if (is In (trackSite Move from:(to) "Track" steps:2) (sites Bottom)) (+ (trackSite Move from:(to) "Track" steps:2) 7) (- (trackSite Move from:(to) "Track" steps:2) 7))) (fromTo (from (if (is In (trackSite Move from:(to) "Track" steps:2) (sites Bottom)) (+ (trackSite Move from:(to) "Track" steps:2) 7) (- (trackSite Move from:(to) "Track" steps:2) 7))) (to (handSite Mover)) count:(count at:(if (is In (trackSite Move from:(to) "Track" steps:2) (sites Bottom)) (+ (trackSite Move from:(to) "Track" steps:2) 7) (- (trackSite Move from:(to) "Track" steps:2) 7)))))))) skipIf:(and (not (is In (to) (sites Centre))) (not (is In (to) (sites (values Remembered "Playable"))))))))} (then (if (all Sites (difference (sites Board) (sites Centre)) if:(= 0 (count at:(site)))) (and {(forget Value "Playable" All) (if (!= 0 (+ (count at:3) (count at:10))) (if (and (= 1 (value Player P1)) (= 1 (value Player P2))) (if (is Even (+ (count at:3) (count at:10))) (and {(fromTo (from 3) (to Cell (handSite P1)) count:(- (count at:3) 1)) (fromTo (from 10) (to Cell (handSite P1)) count:(- (count at:10) 1)) (fromTo (from Cell (handSite P1)) (to Cell (handSite P2)) count:(/ (- (+ (count at:3) (count at:10)) 2) 2))}) (and {(fromTo (from 3) (to Cell (handSite P1)) count:(- (count at:3) 1)) (fromTo (from 10) (to Cell (handSite P1)) count:(count at:10)) (fromTo (from Cell (handSite P1)) (to Cell (handSite P2)) count:(/ (- (+ (count at:3) (count at:10)) 1) 2))})) (if (= 1 (value Player P1)) (and (fromTo (from 3) (to Cell (handSite P1)) count:(- (count at:3) 1)) (fromTo (from 10) (to Cell (handSite P1)) count:(- (count at:10) 1))) (if (= 1 (value Player P2)) (and (fromTo (from 3) (to Cell (handSite P2)) count:(- (count at:3) 1)) (fromTo (from 10) (to Cell (handSite P2)) count:(- (count at:10) 1)))))))}))))) (end (if (all Sites (difference (sites Board) (sites Centre)) if:(= 0 (count at:(site)))) {(if (= 0 (count Cell at:(handSite P1))) (result P2 Win)) (if (= 0 (count Cell at:(handSite P2))) (result P1 Win))})) (nextPhase (all Sites (difference (sites Board) (sites Centre)) if:(= 0 (count at:(site)))) "BetweenRounds")) (phase "BetweenRounds" (play (if (not (all Sites (difference (sites Mover) (sites Centre)) if:(is Occupied (site)))) (if (<= 6 (count Cell at:(handSite Mover))) (move (from Cell (handSite Mover)) (to (difference (sites Mover) (sites Centre)) if:(is Empty (to))) count:6 (then (remember Value "Playable" (last To))))))) (nextPhase (all Passed) "Sowing"))})) 