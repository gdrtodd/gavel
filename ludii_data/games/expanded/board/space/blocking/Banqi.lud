(game "Banqi" (players 2) (equipment {(board (rectangle 4 8)) (piece "Jiang" Each (move Step Orthogonal (to if:(or (is Empty (to)) (and {(not (is Hidden What at:(to) to:Mover)) (is Enemy (who at:(to))) (or (and (= (what at:(from)) (id "Zu" Mover)) (= (what at:(to)) (id "Jiang" Next))) (and (>= (value Piece at:(from)) (value Piece at:(to))) (not (and (= (what at:(from)) (id "Jiang" Mover)) (= (what at:(to)) (id "Zu" Next))))))})) (apply (remove (to)))))) (piece "Ju" Each (move Step Orthogonal (to if:(or (is Empty (to)) (and {(not (is Hidden What at:(to) to:Mover)) (is Enemy (who at:(to))) (or (and (= (what at:(from)) (id "Zu" Mover)) (= (what at:(to)) (id "Jiang" Next))) (and (>= (value Piece at:(from)) (value Piece at:(to))) (not (and (= (what at:(from)) (id "Jiang" Mover)) (= (what at:(to)) (id "Zu" Next))))))})) (apply (remove (to)))))) (piece "Ma" Each (move Step Orthogonal (to if:(or (is Empty (to)) (and {(not (is Hidden What at:(to) to:Mover)) (is Enemy (who at:(to))) (or (and (= (what at:(from)) (id "Zu" Mover)) (= (what at:(to)) (id "Jiang" Next))) (and (>= (value Piece at:(from)) (value Piece at:(to))) (not (and (= (what at:(from)) (id "Jiang" Mover)) (= (what at:(to)) (id "Zu" Next))))))})) (apply (remove (to)))))) (piece "Pao" Each (move Step Orthogonal (to if:(or (is Empty (to)) (and {(not (is Hidden What at:(to) to:Mover)) (is Enemy (who at:(to))) (or (and (= (what at:(from)) (id "Zu" Mover)) (= (what at:(to)) (id "Jiang" Next))) (and (>= (value Piece at:(from)) (value Piece at:(to))) (not (and (= (what at:(from)) (id "Jiang" Mover)) (= (what at:(to)) (id "Zu" Next))))))})) (apply (remove (to)))))) (piece "Shi" Each (move Step Orthogonal (to if:(or (is Empty (to)) (and {(not (is Hidden What at:(to) to:Mover)) (is Enemy (who at:(to))) (or (and (= (what at:(from)) (id "Zu" Mover)) (= (what at:(to)) (id "Jiang" Next))) (and (>= (value Piece at:(from)) (value Piece at:(to))) (not (and (= (what at:(from)) (id "Jiang" Mover)) (= (what at:(to)) (id "Zu" Next))))))})) (apply (remove (to)))))) (piece "Xiang" Each (move Step Orthogonal (to if:(or (is Empty (to)) (and {(not (is Hidden What at:(to) to:Mover)) (is Enemy (who at:(to))) (or (and (= (what at:(from)) (id "Zu" Mover)) (= (what at:(to)) (id "Jiang" Next))) (and (>= (value Piece at:(from)) (value Piece at:(to))) (not (and (= (what at:(from)) (id "Jiang" Mover)) (= (what at:(to)) (id "Zu" Next))))))})) (apply (remove (to)))))) (piece "Zu" Each (move Step Orthogonal (to if:(or (is Empty (to)) (and {(not (is Hidden What at:(to) to:Mover)) (is Enemy (who at:(to))) (or (and (= (what at:(from)) (id "Zu" Mover)) (= (what at:(to)) (id "Jiang" Next))) (and (>= (value Piece at:(from)) (value Piece at:(to))) (not (and (= (what at:(from)) (id "Jiang" Mover)) (= (what at:(to)) (id "Zu" Next))))))})) (apply (remove (to))))))}) (rules (start {(place Random {"Zu1"} count:5 value:1) (place Random {"Zu2"} count:5 value:1) (place Random {"Pao1"} count:2 value:4) (place Random {"Pao2"} count:2 value:4) (place Random {"Ju1"} count:2 value:6) (place Random {"Ju2"} count:2 value:6) (place Random {"Ma1"} count:2 value:5) (place Random {"Ma2"} count:2 value:5) (place Random {"Xiang1"} count:2 value:2) (place Random {"Xiang2"} count:2 value:2) (place Random {"Shi1"} count:2 value:3) (place Random {"Shi2"} count:2 value:3) (place Random {"Jiang1"} count:1 value:7) (place Random {"Jiang2"} count:1 value:7) (set Hidden {What Who} (sites Board) to:P1) (set Hidden {What Who} (sites Board) to:P2)}) phases:{(phase "Opening" P1 (play (move Select (from (sites Hidden What to:Mover)) (then (and {(set Hidden What at:(last To) False to:P1) (set Hidden Who at:(last To) False to:P1) (set Hidden What at:(last To) False to:P2) (set Hidden Who at:(last To) False to:P2) (set NextPlayer (player (who at:(last To))))})))) (nextPhase Mover "Play")) (phase "Play" (play (or (forEach Piece) (move Select (from (sites Hidden What to:Mover)) (then (and {(set Hidden What at:(last To) False to:P1) (set Hidden Who at:(last To) False to:P1) (set Hidden What at:(last To) False to:P2) (set Hidden Who at:(last To) False to:P2)}))))))} (end (if (no Moves Next) (result Mover Win))))) 