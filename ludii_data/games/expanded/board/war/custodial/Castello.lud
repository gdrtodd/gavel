(game "Castello" (players 2) (equipment {(board (rectangle 15 21)) (piece "Pawn" Each (or (move Hop Orthogonal (between if:(and (!= (what at:(between)) (id "Castle0")) (is Occupied (between))) (apply (if (= (who at:(between)) (next)) (remove (between))))) (to if:(is Empty (to))) (then (if (can Move (hop (from (last To)) Orthogonal (between if:(if (< (counter) (- 5 1)) (and (!= (what at:(between)) (id "Castle0")) (is Occupied (between))) (is Friend (who at:(between)))) (apply (if (= (who at:(between)) (next)) (remove (between))))) (to if:(and (is Empty (to)) (not (is Visited (to))))))) (moveAgain) (set Counter)))) (move Step Orthogonal (to if:(is Empty (to)))))) (piece "Castle" Neutral) (hand Each size:3) (regions "LeftPart" (expand (sites Left) steps:6)) (regions "RightPart" (expand (sites Right) steps:6)) (regions "Middle" (expand (sites Centre)))}) (rules (start {(place "Pawn1" (expand (sites Left))) (place "Pawn2" (expand (sites Right))) (place "Castle0" (sites {"G2" "F6" "G10" "F14" "K3" "K8" "K13" "P2" "O6" "P10" "O14"}))}) (play (if (is Prev Mover) (or (move Hop (from (last To)) Orthogonal (between if:(if (< (counter) 5) (and (!= (what at:(between)) (id "Castle0")) (is Occupied (between))) (is Friend (who at:(between)))) (apply (if (= (who at:(between)) (next)) (remove (between))))) (to if:(and (is Empty (to)) (not (is Visited (to))))) (then (if (can Move (hop (from (last To)) Orthogonal (between if:(if (< (counter) (- 5 1)) (and (!= (what at:(between)) (id "Castle0")) (is Occupied (between))) (is Friend (who at:(between)))) (apply (if (= (who at:(between)) (next)) (remove (between))))) (to if:(and (is Empty (to)) (not (is Visited (to))))))) (moveAgain) (set Counter)))) (move Pass)) (forEach Piece) (then (and (if (is In (last To) (sites "LeftPart")) (if (< (count Cell at:(handSite Mover)) 3) (surround (from (last To)) Orthogonal (between if:(= (what at:(between)) (id "Castle0")) (apply (fromTo (from (between)) (to (handSite Mover))))) (to if:(is Friend (who at:(to)))) except:1)) (if (is In (last To) (sites "RightPart")) (surround (from (last To)) Orthogonal (between if:(= (what at:(between)) (id "Castle0")) (apply (fromTo (from (between)) (to (handSite Mover 2))))) (to if:(is Friend (who at:(to)))) except:1) (if (is In (last To) (sites "Middle")) (if (> (count Cell at:(handSite Mover 2)) 0) (surround (from (last To)) Orthogonal (between if:(= (what at:(between)) (id "Castle0")) (apply (fromTo (from (between)) (to (handSite Mover 1))))) (to if:(is Friend (who at:(to)))) except:1)) (surround (from (last To)) Orthogonal (between if:(= (what at:(between)) (id "Castle0")) (apply (fromTo (from (between)) (to (handSite Mover 1))))) (to if:(is Friend (who at:(to)))) except:1)))) (set Counter))))) (end {(if (<= (count Pieces Next) 3) (result Next Loss)) (if (> (count in:(sites Hand Mover)) 3) (result Mover Win))}))) 