(game "Wellisch Chess" (players {(player N) (player ESE) (player WSW)}) (equipment {(board (hex 6)) (piece "King" Each (or {(move Step Orthogonal (to if:(or (is In (to) (sites Empty)) (is Enemy (who at:(to)))) (apply (if (is Enemy (who at:(to))) (if (or {(= (what at:(to)) (id "Pawn" P1)) (= (what at:(to)) (id "Pawn" P2)) (= (what at:(to)) (id "Pawn" P3))}) (remove (to)) (if (or {(= (what at:(to)) (id "King" P1)) (= (what at:(to)) (id "King" P2)) (= (what at:(to)) (id "King" P3))}) (and (trigger "CapturedEnemyKing" Mover) (remove (to))) (move (from (to)) (to (handSite (who at:(to)) (mapEntry "HandIndex" (what at:(to))))) (then (set Counter)))))))) (then (if (= (state at:(last To)) 1) (set State at:(last To) 0)))) (if (and {(= (what at:(mapEntry "King" (mover))) (id "King" Mover)) (= (state at:(mapEntry "King" (mover))) 1) (not (is Threatened (id "King" Mover)))}) (or {(if (is Mover P1) (if (and (= (state at:(mapEntry "RookRight" (mover))) 1) (not (is Threatened (id "King" Mover) at:(mapEntry "RookRight" Mover)))) (move Swap Pieces 3 4 (then (set State at:(last To) 0)))) (if (is Mover P2) (if (and (= (state at:(mapEntry "RookRight" (mover))) 1) (not (is Threatened (id "King" Mover) at:(mapEntry "RookRight" Mover)))) (move Swap Pieces 61 51 (then (set State at:(last To) 0)))) (if (and (= (state at:(mapEntry "RookRight" (mover))) 1) (not (is Threatened (id "King" Mover) at:(mapEntry "RookRight" Mover)))) (move Swap Pieces 77 84 (then (set State at:(last To) 0)))))) (if (is Mover P1) (if (and {(= (state at:(mapEntry "RookLeft" (mover))) 1) (not (is Threatened (id "King" Mover) at:(mapEntry "RookLeft" Mover))) (not (is Threatened (id "King" Mover) at:(mapEntry "Queen" Mover))) (is In (mapEntry "Queen" Mover) (sites Empty))}) (move Swap Pieces 3 1 (then (set State at:(last To) 0)))) (if (is Mover P2) (if (and {(= (state at:(mapEntry "RookLeft" (mover))) 1) (not (is Threatened (id "King" Mover) at:(mapEntry "RookLeft" Mover))) (not (is Threatened (id "King" Mover) at:(mapEntry "Queen" Mover))) (is In (mapEntry "Queen" Mover) (sites Empty))}) (move Swap Pieces 61 78 (then (set State at:(last To) 0)))) (if (and {(= (state at:(mapEntry "RookLeft" (mover))) 1) (not (is Threatened (id "King" Mover) at:(mapEntry "RookLeft" Mover))) (not (is Threatened (id "King" Mover) at:(mapEntry "Queen" Mover))) (is In (mapEntry "Queen" Mover) (sites Empty))}) (move Swap Pieces 77 60 (then (set State at:(last To) 0))))))}))})) (piece "Queen" Each (or (move Slide Orthogonal (to if:(is Enemy (who at:(to))) (apply (if (or {(= (what at:(to)) (id "Pawn" P1)) (= (what at:(to)) (id "Pawn" P2)) (= (what at:(to)) (id "Pawn" P3))}) (remove (to)) (if (or {(= (what at:(to)) (id "King" P1)) (= (what at:(to)) (id "King" P2)) (= (what at:(to)) (id "King" P3))}) (and (trigger "CapturedEnemyKing" Mover) (remove (to))) (move (from (to)) (to (handSite (who at:(to)) (mapEntry "HandIndex" (what at:(to))))) (then (set Counter)))))))) (move Step Diagonal (to if:(or (is In (to) (sites Empty)) (is Enemy (who at:(to)))) (apply (if (is Enemy (who at:(to))) (if (or {(= (what at:(to)) (id "Pawn" P1)) (= (what at:(to)) (id "Pawn" P2)) (= (what at:(to)) (id "Pawn" P3))}) (remove (to)) (if (or {(= (what at:(to)) (id "King" P1)) (= (what at:(to)) (id "King" P2)) (= (what at:(to)) (id "King" P3))}) (and (trigger "CapturedEnemyKing" Mover) (remove (to))) (move (from (to)) (to (handSite (who at:(to)) (mapEntry "HandIndex" (what at:(to))))) (then (set Counter))))))))))) (piece "Rook" Each (move Slide Orthogonal (to if:(is Enemy (who at:(to))) (apply (if (or {(= (what at:(to)) (id "Pawn" P1)) (= (what at:(to)) (id "Pawn" P2)) (= (what at:(to)) (id "Pawn" P3))}) (remove (to)) (if (or {(= (what at:(to)) (id "King" P1)) (= (what at:(to)) (id "King" P2)) (= (what at:(to)) (id "King" P3))}) (and (trigger "CapturedEnemyKing" Mover) (remove (to))) (move (from (to)) (to (handSite (who at:(to)) (mapEntry "HandIndex" (what at:(to))))) (then (set Counter))))))))) (piece "Knight" Each (move Step Diagonal (to if:(or (is In (to) (sites Empty)) (is Enemy (who at:(to)))) (apply (if (is Enemy (who at:(to))) (if (or {(= (what at:(to)) (id "Pawn" P1)) (= (what at:(to)) (id "Pawn" P2)) (= (what at:(to)) (id "Pawn" P3))}) (remove (to)) (if (or {(= (what at:(to)) (id "King" P1)) (= (what at:(to)) (id "King" P2)) (= (what at:(to)) (id "King" P3))}) (and (trigger "CapturedEnemyKing" Mover) (remove (to))) (move (from (to)) (to (handSite (who at:(to)) (mapEntry "HandIndex" (what at:(to))))) (then (set Counter)))))))))) (piece "Pawn" Each (or {(move Step (if (is Mover P1) (directions {NNW NNE}) (if (is Mover P2) (directions {E SSE}) (directions {SSW W}))) (to if:(is Empty (to)))) (move Step (if (is Mover P1) (directions {NNW NNE}) (if (is Mover P2) (directions {E SSE}) (directions {SSW W}))) (to if:(is Enemy (who at:(to))) (apply (if (or {(= (what at:(to)) (id "Pawn" P1)) (= (what at:(to)) (id "Pawn" P2)) (= (what at:(to)) (id "Pawn" P3))}) (remove (to)) (if (or {(= (what at:(to)) (id "King" P1)) (= (what at:(to)) (id "King" P2)) (= (what at:(to)) (id "King" P3))}) (and (trigger "CapturedEnemyKing" Mover) (remove (to))) (move (from (to)) (to (handSite (who at:(to)) (mapEntry "HandIndex" (what at:(to)))))))))))} (then (and (if (is In (last To) (sites Mover "PromotionZone")) (moveAgain)) (set Counter))))) (map "King" {(pair 1 "D1") (pair 2 "C8") (pair 3 "K9")}) (map "RookLeft" {(pair 1 "B1") (pair 2 "E10") (pair 3 "K7")}) (map "RookRight" {(pair 1 "E1") (pair 2 "B7") (pair 3 "K10")}) (map "Queen" {(pair 1 2) (pair 2 70) (pair 3 69)}) (hand Each size:3) (map "HandIndex" {(pair 4 0) (pair 7 1) (pair 10 2) (pair 5 0) (pair 8 1) (pair 11 2) (pair 6 0) (pair 9 1) (pair 12 2)}) (regions "PromotionZone" P1 (sites Top)) (regions "PromotionZone" P2 (sites {"K6" "J5" "I4" "H3" "G2" "F1"})) (regions "PromotionZone" P3 (sites {"A1" "A2" "A3" "A4" "A5" "A6"})) (regions "Region-Grey" (sites Phase 1)) (regions "Region-Red" (sites Phase 2)) (regions "Region-Yellow" (sites Phase 0))}) (rules (start {(place "King1" coord:"D1" state:1) (place "Queen1" coord:"C1") (place "Rook1" {"B1" "E1"} state:1) (place "Knight1" {"A1" "D2" "F1"}) (place "King3" coord:"K9" state:1) (place "Queen3" coord:"K8") (place "Rook3" {"K10" "K7"} state:1) (place "Knight3" {"K11" "J8" "K6"}) (place "King2" coord:"C8" state:1) (place "Queen2" coord:"D9") (place "Rook2" {"B7" "E10"} state:1) (place "Knight2" {"A6" "D8" "F11"}) (place "Pawn1" {"A2" "B2" "C2" "D3" "E3" "E2" "F2" "G2"}) (place "Pawn3" {"J11" "J10" "J9" "I8" "I7" "J7" "J6" "J5"}) (place "Pawn2" {"A5" "B6" "C7" "D7" "E8" "E9" "F10" "G11"})}) phases:{(phase "Movement" (play (if (is Prev Mover) (if (not (all Sites (sites Hand Mover) if:(= 0 (count Cell at:(site))))) (move (from (sites Occupied by:Mover container:"Hand" components:{"Queen" "Rook" "Knight"})) (to (last To)))) (do (if (> (count in:(sites Hand Mover)) 0) (move (from (sites Occupied by:Mover container:"Hand" components:{"Queen" "Rook" "Knight"})) (to (sites Mover "PromotionZone") if:(= (what at:(to)) (id "Pawn" Mover))))) next:(do (forEach Piece) ifAfterwards:(not (is Threatened (id "King" Mover))))))) (end {(if (is Triggered "CapturedEnemyKing" P1) (result P1 Win)) (if (is Triggered "CapturedEnemyKing" P2) (result P2 Win)) (if (is Triggered "CapturedEnemyKing" P3) (result P3 Win)) (if (= (where "King" P1) -1) (result P1 Loss)) (if (= (where "King" P2) -1) (result P2 Loss)) (if (= (where "King" P3) -1) (result P3 Loss)) (if (= (counter) 100) (result Mover Draw))}))})) 