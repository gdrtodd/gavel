(game "Hexshogi" (players {(player N) (player S)}) (equipment {(board (rotate 90 (remove (hex Rectangle 9 11) cells:{0 10 21 31 42 52 63 73 84 94}))) (piece "Osho" Each (move Step All (to if:(not (is Friend (who at:(to)))) (apply (if (is Enemy (who at:(to))) (add (piece (mapEntry "Captured" (what at:(to)))) (to (mapEntry "Where" (what at:(to)))))))))) (piece "Fuhyo" Each (move Step Forward (to if:(not (is Friend (who at:(to)))) (apply (if (is Enemy (who at:(to))) (add (piece (mapEntry "Captured" (what at:(to)))) (to (mapEntry "Where" (what at:(to)))))))) (then (if (is In (last To) (sites Mover "Promotion")) (if (is In (last To) (sites Mover "LastRank")) (move Promote (last To) (piece (mapEntry "Promoted" (what at:(last To))))) (moveAgain)))))) (piece "Ginsho" Each (move Leap {{F} {F L F} {F R F} {L F L F} {R F R F} {L L F L F} {R R F R F}} rotations:False (to if:(not (is Friend (who at:(to)))) (apply (if (is Enemy (who at:(to))) (add (piece (mapEntry "Captured" (what at:(to)))) (to (mapEntry "Where" (what at:(to)))))))))) (piece "Hisha" Each (move Slide Orthogonal (to if:(is Enemy (who at:(to))) (apply (if (is Enemy (who at:(to))) (add (piece (mapEntry "Captured" (what at:(to)))) (to (mapEntry "Where" (what at:(to)))))))) (then (if (or (is In (last To) (sites Mover "Promotion")) (is In (last From) (sites Mover "Promotion"))) (moveAgain))))) (piece "Kakugyo" Each (move Slide Diagonal (to if:(is Enemy (who at:(to))) (apply (if (is Enemy (who at:(to))) (add (piece (mapEntry "Captured" (what at:(to)))) (to (mapEntry "Where" (what at:(to)))))))) (then (if (or (is In (last To) (sites Mover "Promotion")) (is In (last From) (sites Mover "Promotion"))) (moveAgain))))) (piece "Keima" Each (move Leap {{F F R F} {F F L F}} rotations:False (to if:(not (is Friend (who at:(to)))) (apply if:(is Enemy (who at:(to))) (add (piece (mapEntry "Captured" (what at:(to)))) (to (mapEntry "Where" (what at:(to))))))) (then (if (is In (last To) (sites Mover "Promotion")) (if (is In (last To) (sites Mover "TwoFurthestRank")) (move Promote (last To) (piece (mapEntry "Promoted" (what at:(last To))))) (moveAgain)))))) (piece "Kyosha" Each (move Slide Forward (to if:(is Enemy (who at:(to))) (apply (if (is Enemy (who at:(to))) (add (piece (mapEntry "Captured" (what at:(to)))) (to (mapEntry "Where" (what at:(to)))))))) (then (if (is In (last To) (sites Mover "Promotion")) (if (is In (last To) (sites Mover "LastRank")) (move Promote (last To) (piece (mapEntry "Promoted" (what at:(last To))))) (moveAgain)))))) (piece "Kinsho" Each (move Leap {{F} {F L F} {F R F} {L F} {R F} {L L F} {R R F} {L L L F}} rotations:False (to if:(not (is Friend (who at:(to)))) (apply (if (is Enemy (who at:(to))) (add (piece (mapEntry "Captured" (what at:(to)))) (to (mapEntry "Where" (what at:(to)))))))))) (piece "Tokin" Each (move Leap {{F} {F L F} {F R F} {L F} {R F} {L L F} {R R F} {L L L F}} rotations:False (to if:(not (is Friend (who at:(to)))) (apply (if (is Enemy (who at:(to))) (add (piece (mapEntry "Captured" (what at:(to)))) (to (mapEntry "Where" (what at:(to)))))))))) (piece "Narigin" Each (move Leap {{F} {F L F} {F R F} {L F} {R F} {L L F} {R R F} {L L L F}} rotations:False (to if:(not (is Friend (who at:(to)))) (apply (if (is Enemy (who at:(to))) (add (piece (mapEntry "Captured" (what at:(to)))) (to (mapEntry "Where" (what at:(to)))))))))) (piece "Ryuo" Each (or (move Slide Orthogonal (to if:(is Enemy (who at:(to))) (apply (if (is Enemy (who at:(to))) (add (piece (mapEntry "Captured" (what at:(to)))) (to (mapEntry "Where" (what at:(to))))))))) (move Step Diagonal (to if:(not (is Friend (who at:(to)))) (apply (if (is Enemy (who at:(to))) (add (piece (mapEntry "Captured" (what at:(to)))) (to (mapEntry "Where" (what at:(to))))))))))) (piece "Ryuma" Each (or (move Slide Diagonal (to if:(is Enemy (who at:(to))) (apply (if (is Enemy (who at:(to))) (add (piece (mapEntry "Captured" (what at:(to)))) (to (mapEntry "Where" (what at:(to))))))))) (move Step Orthogonal (to if:(not (is Friend (who at:(to)))) (apply (if (is Enemy (who at:(to))) (add (piece (mapEntry "Captured" (what at:(to)))) (to (mapEntry "Where" (what at:(to))))))))))) (piece "Narikei" Each (move Leap {{F} {F L F} {F R F} {L F} {R F} {L L F} {R R F} {L L L F}} rotations:False (to if:(not (is Friend (who at:(to)))) (apply (if (is Enemy (who at:(to))) (add (piece (mapEntry "Captured" (what at:(to)))) (to (mapEntry "Where" (what at:(to)))))))))) (piece "Narikyo" Each (move Leap {{F} {F L F} {F R F} {L F} {R F} {L L F} {R R F} {L L L F}} rotations:False (to if:(not (is Friend (who at:(to)))) (apply (if (is Enemy (who at:(to))) (add (piece (mapEntry "Captured" (what at:(to)))) (to (mapEntry "Where" (what at:(to)))))))))) (regions "LastRankP1" P1 (forEach (sites Board) if:(= (site) (ahead (site) N)))) (regions "LastRankP2" P2 (forEach (sites Board) if:(= (site) (ahead (site) S)))) (regions "TwoFurthestRankP1" P1 (forEach (sites Board) if:(= (site) (ahead (site) steps:2 N)))) (regions "TwoFurthestRankP2" P2 (forEach (sites Board) if:(= (site) (ahead (site) steps:2 S)))) (regions "Promotion" P1 (forEach (sites Board) if:(= (site) (ahead (site) steps:3 N)))) (regions "Promotion" P2 (forEach (sites Board) if:(= (site) (ahead (site) steps:3 S)))) (map "Where" {(pair (id "Fuhyo" P1) (handSite P2)) (pair (id "Fuhyo" P2) (handSite P1)) (pair (id "Ginsho" P1) (handSite P2 1)) (pair (id "Ginsho" P2) (handSite P1 1)) (pair (id "Hisha" P1) (handSite P2 2)) (pair (id "Hisha" P2) (handSite P1 2)) (pair (id "Kakugyo" P1) (handSite P2 3)) (pair (id "Kakugyo" P2) (handSite P1 3)) (pair (id "Keima" P1) (handSite P2 4)) (pair (id "Keima" P2) (handSite P1 4)) (pair (id "Kyosha" P1) (handSite P2 5)) (pair (id "Kyosha" P2) (handSite P1 5)) (pair (id "Kinsho" P1) (handSite P2 6)) (pair (id "Kinsho" P2) (handSite P1 6)) (pair (id "Tokin" P1) (handSite P2)) (pair (id "Tokin" P2) (handSite P1)) (pair (id "Narigin" P1) (handSite P2 1)) (pair (id "Narigin" P2) (handSite P1 1)) (pair (id "Ryuo" P1) (handSite P2 2)) (pair (id "Ryuo" P2) (handSite P1 2)) (pair (id "Ryuma" P1) (handSite P2 3)) (pair (id "Ryuma" P2) (handSite P1 3)) (pair (id "Narikei" P1) (handSite P2 4)) (pair (id "Narikei" P2) (handSite P1 4)) (pair (id "Narikyo" P1) (handSite P2 5)) (pair (id "Narikyo" P2) (handSite P1 5))}) (map "Captured" {(pair (id "Fuhyo" P1) (id "Fuhyo" P2)) (pair (id "Fuhyo" P2) (id "Fuhyo" P1)) (pair (id "Ginsho" P1) (id "Ginsho" P2)) (pair (id "Ginsho" P2) (id "Ginsho" P1)) (pair (id "Hisha" P1) (id "Hisha" P2)) (pair (id "Hisha" P2) (id "Hisha" P1)) (pair (id "Kakugyo" P1) (id "Kakugyo" P2)) (pair (id "Kakugyo" P2) (id "Kakugyo" P1)) (pair (id "Keima" P1) (id "Keima" P2)) (pair (id "Keima" P2) (id "Keima" P1)) (pair (id "Kyosha" P1) (id "Kyosha" P2)) (pair (id "Kyosha" P2) (id "Kyosha" P1)) (pair (id "Kinsho" P1) (id "Kinsho" P2)) (pair (id "Kinsho" P2) (id "Kinsho" P1)) (pair (id "Tokin" P1) (id "Fuhyo" P2)) (pair (id "Tokin" P2) (id "Fuhyo" P1)) (pair (id "Narigin" P1) (id "Ginsho" P2)) (pair (id "Narigin" P2) (id "Ginsho" P1)) (pair (id "Ryuo" P1) (id "Hisha" P2)) (pair (id "Ryuo" P2) (id "Hisha" P1)) (pair (id "Ryuma" P1) (id "Kakugyo" P2)) (pair (id "Ryuma" P2) (id "Kakugyo" P1)) (pair (id "Narikei" P1) (id "Keima" P2)) (pair (id "Narikei" P2) (id "Keima" P1)) (pair (id "Narikyo" P1) (id "Kyosha" P2)) (pair (id "Narikyo" P2) (id "Kyosha" P1))}) (map "Promoted" {(pair (id "Fuhyo" P1) (id "Tokin" P1)) (pair (id "Fuhyo" P2) (id "Tokin" P2)) (pair (id "Ginsho" P1) (id "Narigin" P1)) (pair (id "Ginsho" P2) (id "Narigin" P2)) (pair (id "Hisha" P1) (id "Ryuo" P1)) (pair (id "Hisha" P2) (id "Ryuo" P2)) (pair (id "Kakugyo" P1) (id "Ryuma" P1)) (pair (id "Kakugyo" P2) (id "Ryuma" P2)) (pair (id "Keima" P1) (id "Narikei" P1)) (pair (id "Keima" P2) (id "Narikei" P2)) (pair (id "Kyosha" P1) (id "Narikyo" P1)) (pair (id "Kyosha" P2) (id "Narikyo" P2))}) (hand Each size:7)}) (rules (start {(place "Osho1" coord:"C3") (place "Kinsho1" {"B3" "C2"}) (place "Ginsho1" {"B4" "D2"}) (place "Keima1" {"A4" "D1"}) (place "Kyosha1" {"A5" "E1"}) (place "Kakugyo1" coord:"C5") (place "Hisha1" coord:"E3") (place "Fuhyo1" {"C7" "C6" "D6" "D5" "E5" "E4" "F4" "F3" "G3"}) (place "Osho2" coord:"K11") (place "Kinsho2" {"K12" "L11"}) (place "Ginsho2" {"J12" "L10"}) (place "Keima2" {"J13" "M10"}) (place "Kyosha2" {"I13" "M9"}) (place "Kakugyo2" coord:"K9") (place "Hisha2" coord:"I11") (place "Fuhyo2" {"G11" "H11" "H10" "I10" "I9" "J9" "J8" "K8" "K7"})}) (play (if (is Prev Mover) (or (move Promote (last To) (piece (mapEntry "Promoted" (what at:(last To))))) (move Pass)) (do (or {(move (from (sites Occupied by:Mover container:"Hand" components:{"Kakugyo" "Ginsho" "Hisha" "Kinsho"})) (to (sites Empty))) (do (move (from (sites Occupied by:Mover container:"Hand" component:"Fuhyo")) (to (difference (sites Empty) (sites Mover "LastRank")) if:(= (count Sites in:(sites Occupied by:Mover container:"Board" component:"Fuhyo")) (count Sites in:(difference (sites Occupied by:Mover container:"Board" component:"Fuhyo") (union (sites Direction from:(to) N) (sites Direction from:(to) S))))))) ifAfterwards:(not (and (is Threatened (id "Osho" Next)) (not (can Move (do (or {(move (from (sites Occupied by:Next container:"Hand" components:{"Kakugyo" "Ginsho" "Hisha" "Kinsho"})) (to (sites Empty))) (do (move (from (sites Occupied by:Next container:"Hand" component:"Fuhyo")) (to (difference (sites Empty) (sites Next "LastRank")) if:(= (count Sites in:(sites Occupied by:Next container:"Board" component:"Fuhyo")) (count Sites in:(difference (sites Occupied by:Next container:"Board" component:"Fuhyo") (union (sites Direction from:(to) N) (sites Direction from:(to) S))))))) ifAfterwards:(not (is Threatened (id "Osho" Mover)))) (move (from (sites Occupied by:Next container:"Hand" component:"Kyosha")) (to (difference (sites Empty) (sites Next "LastRank")))) (move (from (sites Occupied by:Next container:"Hand" component:"Keima")) (to (difference (sites Empty) (sites Next "TwoFurthestRank")))) (forEach Piece Next)}) ifAfterwards:(not (is Threatened (id "Osho" Next))))))))) (move (from (sites Occupied by:Mover container:"Hand" component:"Kyosha")) (to (difference (sites Empty) (sites Mover "LastRank")))) (move (from (sites Occupied by:Mover container:"Hand" component:"Keima")) (to (difference (sites Empty) (sites Mover "TwoFurthestRank")))) (forEach Piece)}) ifAfterwards:(not (is Threatened (id "Osho" Mover)))))) (end {(if (and (is Threatened (id "Osho" Next)) (not (can Move (do (or {(move (from (sites Occupied by:Next container:"Hand" components:{"Kakugyo" "Ginsho" "Hisha" "Kinsho"})) (to (sites Empty))) (do (move (from (sites Occupied by:Next container:"Hand" component:"Fuhyo")) (to (difference (sites Empty) (sites Next "LastRank")) if:(= (count Sites in:(sites Occupied by:Next container:"Board" component:"Fuhyo")) (count Sites in:(difference (sites Occupied by:Next container:"Board" component:"Fuhyo") (union (sites Direction from:(to) N) (sites Direction from:(to) S))))))) ifAfterwards:(not (is Threatened (id "Osho" Mover)))) (move (from (sites Occupied by:Next container:"Hand" component:"Kyosha")) (to (difference (sites Empty) (sites Next "LastRank")))) (move (from (sites Occupied by:Next container:"Hand" component:"Keima")) (to (difference (sites Empty) (sites Next "TwoFurthestRank")))) (forEach Piece Next)}) ifAfterwards:(not (is Threatened (id "Osho" Next))))))) (result Mover Win)) (if (no Moves Next) (result Mover Win))}))) 