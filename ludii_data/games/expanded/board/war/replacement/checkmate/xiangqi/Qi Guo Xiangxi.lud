(game "Qi Guo Xiangxi" (players 7) (equipment {(board (square 19) use:Vertex) (piece "King" Shared) (piece "General" Each (move Slide All (between if:(and {(is Empty (between)) (!= (who at:(between)) Shared) (not (= (what at:(between)) (id "Diplomat" P1))) (not (= (what at:(between)) (id "Diplomat" P2))) (not (= (what at:(between)) (id "Diplomat" P3))) (not (= (what at:(between)) (id "Diplomat" P4))) (not (= (what at:(between)) (id "Diplomat" P5))) (not (= (what at:(between)) (id "Diplomat" P6))) (not (= (what at:(between)) (id "Diplomat" P7)))})) (to if:(and {(is Enemy (who at:(to))) (!= (who at:(to)) Shared) (not (= (what at:(to)) (id "Diplomat" P1))) (not (= (what at:(to)) (id "Diplomat" P2))) (not (= (what at:(to)) (id "Diplomat" P3))) (not (= (what at:(to)) (id "Diplomat" P4))) (not (= (what at:(to)) (id "Diplomat" P5))) (not (= (what at:(to)) (id "Diplomat" P6))) (not (= (what at:(to)) (id "Diplomat" P7)))}) (apply (if (is Enemy (who at:(to))) (do (if (or {(= (what at:(to)) (id "General" P1)) (= (what at:(to)) (id "General" P2)) (= (what at:(to)) (id "General" P3)) (= (what at:(to)) (id "General" P4)) (= (what at:(to)) (id "General" P5)) (= (what at:(to)) (id "General" P6)) (= (what at:(to)) (id "General" P7))}) (add (piece (id "General" Mover)) (to (handSite Mover)))) next:(remove (to) (then (addScore Mover 1))))))))) (piece "Deputy General" Each (move Slide Orthogonal (between if:(and {(is Empty (between)) (!= (who at:(between)) Shared) (not (= (what at:(between)) (id "Diplomat" P1))) (not (= (what at:(between)) (id "Diplomat" P2))) (not (= (what at:(between)) (id "Diplomat" P3))) (not (= (what at:(between)) (id "Diplomat" P4))) (not (= (what at:(between)) (id "Diplomat" P5))) (not (= (what at:(between)) (id "Diplomat" P6))) (not (= (what at:(between)) (id "Diplomat" P7)))})) (to if:(and {(is Enemy (who at:(to))) (!= (who at:(to)) Shared) (not (= (what at:(to)) (id "Diplomat" P1))) (not (= (what at:(to)) (id "Diplomat" P2))) (not (= (what at:(to)) (id "Diplomat" P3))) (not (= (what at:(to)) (id "Diplomat" P4))) (not (= (what at:(to)) (id "Diplomat" P5))) (not (= (what at:(to)) (id "Diplomat" P6))) (not (= (what at:(to)) (id "Diplomat" P7)))}) (apply (if (is Enemy (who at:(to))) (do (if (or {(= (what at:(to)) (id "General" P1)) (= (what at:(to)) (id "General" P2)) (= (what at:(to)) (id "General" P3)) (= (what at:(to)) (id "General" P4)) (= (what at:(to)) (id "General" P5)) (= (what at:(to)) (id "General" P6)) (= (what at:(to)) (id "General" P7))}) (add (piece (id "General" Mover)) (to (handSite Mover)))) next:(remove (to) (then (addScore Mover 1))))))))) (piece "Officer" Each (move Slide Diagonal (between if:(and {(is Empty (between)) (!= (who at:(between)) Shared) (not (= (what at:(between)) (id "Diplomat" P1))) (not (= (what at:(between)) (id "Diplomat" P2))) (not (= (what at:(between)) (id "Diplomat" P3))) (not (= (what at:(between)) (id "Diplomat" P4))) (not (= (what at:(between)) (id "Diplomat" P5))) (not (= (what at:(between)) (id "Diplomat" P6))) (not (= (what at:(between)) (id "Diplomat" P7)))})) (to if:(and {(is Enemy (who at:(to))) (!= (who at:(to)) Shared) (not (= (what at:(to)) (id "Diplomat" P1))) (not (= (what at:(to)) (id "Diplomat" P2))) (not (= (what at:(to)) (id "Diplomat" P3))) (not (= (what at:(to)) (id "Diplomat" P4))) (not (= (what at:(to)) (id "Diplomat" P5))) (not (= (what at:(to)) (id "Diplomat" P6))) (not (= (what at:(to)) (id "Diplomat" P7)))}) (apply (if (is Enemy (who at:(to))) (do (if (or {(= (what at:(to)) (id "General" P1)) (= (what at:(to)) (id "General" P2)) (= (what at:(to)) (id "General" P3)) (= (what at:(to)) (id "General" P4)) (= (what at:(to)) (id "General" P5)) (= (what at:(to)) (id "General" P6)) (= (what at:(to)) (id "General" P7))}) (add (piece (id "General" Mover)) (to (handSite Mover)))) next:(remove (to) (then (addScore Mover 1))))))))) (piece "Diplomat" Each (move Slide All)) (piece "Archer" Each (move Hop All (between (exact 3) if:(is Empty (between))) (to if:(or (is Empty (to)) (and {(is Enemy (who at:(to))) (!= (who at:(to)) Shared) (not (= (what at:(to)) (id "Diplomat" P1))) (not (= (what at:(to)) (id "Diplomat" P2))) (not (= (what at:(to)) (id "Diplomat" P3))) (not (= (what at:(to)) (id "Diplomat" P4))) (not (= (what at:(to)) (id "Diplomat" P5))) (not (= (what at:(to)) (id "Diplomat" P6))) (not (= (what at:(to)) (id "Diplomat" P7)))})) (apply (if (is Enemy (who at:(to))) (do (if (or {(= (what at:(to)) (id "General" P1)) (= (what at:(to)) (id "General" P2)) (= (what at:(to)) (id "General" P3)) (= (what at:(to)) (id "General" P4)) (= (what at:(to)) (id "General" P5)) (= (what at:(to)) (id "General" P6)) (= (what at:(to)) (id "General" P7))}) (add (piece (id "General" Mover)) (to (handSite Mover)))) next:(remove (to) (then (addScore Mover 1))))))))) (piece "CrossBow" Each (move Hop All (between (exact 4) if:(is Empty (between))) (to if:(or (is Empty (to)) (and {(is Enemy (who at:(to))) (!= (who at:(to)) Shared) (not (= (what at:(to)) (id "Diplomat" P1))) (not (= (what at:(to)) (id "Diplomat" P2))) (not (= (what at:(to)) (id "Diplomat" P3))) (not (= (what at:(to)) (id "Diplomat" P4))) (not (= (what at:(to)) (id "Diplomat" P5))) (not (= (what at:(to)) (id "Diplomat" P6))) (not (= (what at:(to)) (id "Diplomat" P7)))})) (apply (if (is Enemy (who at:(to))) (do (if (or {(= (what at:(to)) (id "General" P1)) (= (what at:(to)) (id "General" P2)) (= (what at:(to)) (id "General" P3)) (= (what at:(to)) (id "General" P4)) (= (what at:(to)) (id "General" P5)) (= (what at:(to)) (id "General" P6)) (= (what at:(to)) (id "General" P7))}) (add (piece (id "General" Mover)) (to (handSite Mover)))) next:(remove (to) (then (addScore Mover 1))))))))) (piece "Knife" Each (move Step Diagonal (to if:(or (is Empty (to)) (and {(is Enemy (who at:(to))) (!= (who at:(to)) Shared) (not (= (what at:(to)) (id "Diplomat" P1))) (not (= (what at:(to)) (id "Diplomat" P2))) (not (= (what at:(to)) (id "Diplomat" P3))) (not (= (what at:(to)) (id "Diplomat" P4))) (not (= (what at:(to)) (id "Diplomat" P5))) (not (= (what at:(to)) (id "Diplomat" P6))) (not (= (what at:(to)) (id "Diplomat" P7)))})) (apply (if (is Enemy (who at:(to))) (do (if (or {(= (what at:(to)) (id "General" P1)) (= (what at:(to)) (id "General" P2)) (= (what at:(to)) (id "General" P3)) (= (what at:(to)) (id "General" P4)) (= (what at:(to)) (id "General" P5)) (= (what at:(to)) (id "General" P6)) (= (what at:(to)) (id "General" P7))}) (add (piece (id "General" Mover)) (to (handSite Mover)))) next:(remove (to) (then (addScore Mover 1))))))))) (piece "Broadsword" Each (move Step Orthogonal (to if:(or (is Empty (to)) (and {(is Enemy (who at:(to))) (!= (who at:(to)) Shared) (not (= (what at:(to)) (id "Diplomat" P1))) (not (= (what at:(to)) (id "Diplomat" P2))) (not (= (what at:(to)) (id "Diplomat" P3))) (not (= (what at:(to)) (id "Diplomat" P4))) (not (= (what at:(to)) (id "Diplomat" P5))) (not (= (what at:(to)) (id "Diplomat" P6))) (not (= (what at:(to)) (id "Diplomat" P7)))})) (apply (if (is Enemy (who at:(to))) (do (if (or {(= (what at:(to)) (id "General" P1)) (= (what at:(to)) (id "General" P2)) (= (what at:(to)) (id "General" P3)) (= (what at:(to)) (id "General" P4)) (= (what at:(to)) (id "General" P5)) (= (what at:(to)) (id "General" P6)) (= (what at:(to)) (id "General" P7))}) (add (piece (id "General" Mover)) (to (handSite Mover)))) next:(remove (to) (then (addScore Mover 1))))))))) (piece "Catapult" Each (or (move Slide Orthogonal) (move Hop Orthogonal (between before:(count Rows) after:(count Rows) if:(is Friend (who at:(between)))) (to if:(is Empty (to)) (apply if:(and {(is Enemy (who at:(to))) (!= (who at:(to)) Shared) (not (= (what at:(to)) (id "Diplomat" P1))) (not (= (what at:(to)) (id "Diplomat" P2))) (not (= (what at:(to)) (id "Diplomat" P3))) (not (= (what at:(to)) (id "Diplomat" P4))) (not (= (what at:(to)) (id "Diplomat" P5))) (not (= (what at:(to)) (id "Diplomat" P6))) (not (= (what at:(to)) (id "Diplomat" P7)))}) (do (if (or {(= (what at:(to)) (id "General" P1)) (= (what at:(to)) (id "General" P2)) (= (what at:(to)) (id "General" P3)) (= (what at:(to)) (id "General" P4)) (= (what at:(to)) (id "General" P5)) (= (what at:(to)) (id "General" P6)) (= (what at:(to)) (id "General" P7))}) (add (piece (id "General" Mover)) (to (handSite Mover)))) next:(remove (to) (then (addScore Mover 1))))))))) (piece "Knight" Each (forEach Direction Orthogonal (to if:(is Empty (to)) (apply (forEach Direction (from (to)) (directions {FR FL} of:All) (between (exact 3) if:(is Empty (between))) (if (or (is Empty (to)) (and {(is Enemy (who at:(to))) (!= (who at:(to)) Shared) (not (= (what at:(to)) (id "Diplomat" P1))) (not (= (what at:(to)) (id "Diplomat" P2))) (not (= (what at:(to)) (id "Diplomat" P3))) (not (= (what at:(to)) (id "Diplomat" P4))) (not (= (what at:(to)) (id "Diplomat" P5))) (not (= (what at:(to)) (id "Diplomat" P6))) (not (= (what at:(to)) (id "Diplomat" P7)))})) (move (from) (to (apply if:(is Enemy (who at:(to))) (do (if (or {(= (what at:(to)) (id "General" P1)) (= (what at:(to)) (id "General" P2)) (= (what at:(to)) (id "General" P3)) (= (what at:(to)) (id "General" P4)) (= (what at:(to)) (id "General" P5)) (= (what at:(to)) (id "General" P6)) (= (what at:(to)) (id "General" P7))}) (add (piece (id "General" Mover)) (to (handSite Mover)))) next:(remove (to) (then (addScore Mover 1))))))))))))) (hand Each)}) (rules (start {(place "King" (centrePoint)) (place "General1" coord:"A10") (place "General2" coord:"F1") (place "General3" coord:"N1") (place "General4" coord:"S6") (place "General5" coord:"S14") (place "General6" coord:"N19") (place "General7" coord:"F19") (place "Deputy General1" coord:"A11") (place "Deputy General2" coord:"E1") (place "Deputy General3" coord:"M1") (place "Deputy General4" coord:"S5") (place "Deputy General5" coord:"S13") (place "Deputy General6" coord:"O19") (place "Deputy General7" coord:"G19") (place "Officer1" coord:"A9") (place "Officer2" coord:"G1") (place "Officer3" coord:"O1") (place "Officer4" coord:"S7") (place "Officer5" coord:"S15") (place "Officer6" coord:"M19") (place "Officer7" coord:"E19") (place "Catapult1" coord:"B10") (place "Catapult2" coord:"F2") (place "Catapult3" coord:"N2") (place "Catapult4" coord:"R6") (place "Catapult5" coord:"R14") (place "Catapult6" coord:"N18") (place "Catapult7" coord:"F18") (place "Broadsword1" {"A12" "B11" "B9" "A8"}) (place "Broadsword2" {"D1" "E2" "G2" "H1"}) (place "Broadsword3" {"L1" "M2" "O2" "P1"}) (place "Broadsword4" {"S4" "R5" "R7" "S8"}) (place "Broadsword5" {"S12" "R13" "R15" "S16"}) (place "Broadsword6" {"P19" "O18" "M18" "L19"}) (place "Broadsword7" {"H19" "G18" "E18" "D19"}) (place "Knight1" {"A13" "B12" "B8" "A7"}) (place "Knight2" {"C1" "D2" "H2" "I1"}) (place "Knight3" {"K1" "L2" "P2" "Q1"}) (place "Knight4" {"S3" "R4" "R8" "S9"}) (place "Knight5" {"S11" "R12" "R16" "S17"}) (place "Knight6" {"P18" "Q19" "L18" "K19"}) (place "Knight7" {"H18" "I19" "D18" "C19"}) (place "CrossBow1" coord:"C10") (place "CrossBow2" coord:"F3") (place "CrossBow3" coord:"N3") (place "CrossBow4" coord:"Q6") (place "CrossBow5" coord:"Q14") (place "CrossBow6" coord:"N17") (place "CrossBow7" coord:"F17") (place "Knife1" {"C9" "C11"}) (place "Knife2" {"E3" "G3"}) (place "Knife3" {"M3" "O3"}) (place "Knife4" {"Q5" "Q7"}) (place "Knife5" {"Q13" "Q15"}) (place "Knife6" {"O17" "M17"}) (place "Knife7" {"G17" "E17"}) (place "Archer1" coord:"D10") (place "Archer2" coord:"F4") (place "Archer3" coord:"N4") (place "Archer4" coord:"P6") (place "Archer5" coord:"P14") (place "Archer6" coord:"N16") (place "Archer7" coord:"F16") (place "Diplomat1" coord:"E10") (place "Diplomat2" coord:"F5") (place "Diplomat3" coord:"N5") (place "Diplomat4" coord:"O6") (place "Diplomat5" coord:"O14") (place "Diplomat6" coord:"N15") (place "Diplomat7" coord:"F15")}) (play (forEach Piece (then (and {(if (and (is Active P1) (or (<= (count Pieces P1 in:(sites Board)) 7) (= (where "General" P1) -1))) (remove (sites Occupied by:P1 container:"Board"))) (if (and (is Active P2) (or (<= (count Pieces P2 in:(sites Board)) 7) (= (where "General" P2) -1))) (remove (sites Occupied by:P2 container:"Board"))) (if (and (is Active P3) (or (<= (count Pieces P3 in:(sites Board)) 7) (= (where "General" P3) -1))) (remove (sites Occupied by:P3 container:"Board"))) (if (and (is Active P4) (or (<= (count Pieces P4 in:(sites Board)) 7) (= (where "General" P4) -1))) (remove (sites Occupied by:P4 container:"Board"))) (if (and (is Active P5) (or (<= (count Pieces P5 in:(sites Board)) 7) (= (where "General" P5) -1))) (remove (sites Occupied by:P5 container:"Board"))) (if (and (is Active P6) (or (<= (count Pieces P6 in:(sites Board)) 7) (= (where "General" P6) -1))) (remove (sites Occupied by:P6 container:"Board"))) (if (and (is Active P7) (or (<= (count Pieces P7 in:(sites Board)) 7) (= (where "General" P7) -1))) (remove (sites Occupied by:P7 container:"Board")))})))) (end {(if (= (count Pieces P1 in:(sites Board)) 0) (result P1 Loss)) (if (= (count Pieces P2 in:(sites Board)) 0) (result P2 Loss)) (if (= (count Pieces P3 in:(sites Board)) 0) (result P3 Loss)) (if (= (count Pieces P4 in:(sites Board)) 0) (result P4 Loss)) (if (= (count Pieces P5 in:(sites Board)) 0) (result P5 Loss)) (if (= (count Pieces P6 in:(sites Board)) 0) (result P6 Loss)) (if (= (count Pieces P7 in:(sites Board)) 0) (result P7 Loss)) (if (or (= (score Mover) 30) (= 2 (count Cell at:(handSite Mover)))) (byScore))}))) 