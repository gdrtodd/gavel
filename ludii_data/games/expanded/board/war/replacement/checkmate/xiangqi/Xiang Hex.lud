(game "Xiang Hex" (players {(player N) (player S)}) (equipment {(board (renumber Cell (rotate 90 (remove (hex Rectangle 9 11) cells:{0 1 11 21 63 74 85 84 94 93 83 73 31 20 9 10})))) (piece "Jiang" Each (move Step Orthogonal (to if:(and (is In (to) (sites Mover "Palace")) (not (is Friend (who at:(to))))) (apply (remove (to)))))) (piece "Shi" Each (move Step Diagonal (to if:(and (is In (to) (sites Mover "Palace")) (not (is Friend (who at:(to))))) (apply (remove (to)))))) (piece "Xiang" Each (move Slide Diagonal (between (exact 2) if:(and {(is In (between) (sites Mover "Home")) (is Empty (between))})) (to if:(is Enemy (who at:(to))) (apply (remove (to)))))) (piece "Ma" Each (forEach Direction Orthogonal (to if:(is Empty (to)) (apply (forEach Direction (from (to)) (directions {FR FL} of:All) (if (not (is Friend (who at:(to)))) (move (from) (to (apply if:(is Enemy (who at:(to))) (remove (to))))))))))) (piece "Ju" Each (move Slide Orthogonal (to if:(is Enemy (who at:(to))) (apply (remove (to)))))) (piece "Pao" Each (or (move Slide Orthogonal) (move Hop Orthogonal (between before:(count Rows) after:(count Rows) if:(is Occupied (between))) (to if:(is Empty (to)) (apply if:(is Enemy (who at:(to))) (remove (to))))))) (piece "Zu" Each (move Step (if (is In (from) (sites Mover "Home")) Forward (union (directions {Forward FL FR}) (directions {W E}))) (to if:(not (is Friend (who at:(to)))) (apply (remove (to)))))) (regions "PalaceP1" P1 {0 1 2 4 7 8 12}) (regions "PalaceP2" P2 {66 70 71 74 76 77 78}) (regions "Home" P1 (forEach (sites Board) if:(< (site) 37))) (regions "Home" P2 (forEach (sites Board) if:(> (site) 41)))}) (rules (start {(place "Jiang1" coord:"A1") (place "Shi1" {"A2" "B1"}) (place "Xiang1" {"A3" "C1"}) (place "Ma1" {"A4" "D1"}) (place "Ju1" {"A5" "E1"}) (place "Pao1" {"B5" "E2"}) (place "Zu1" {"B6" "C5" "D4" "E3" "F2"}) (place "Jiang2" coord:"K11") (place "Shi2" {"J11" "K10"}) (place "Xiang2" {"I11" "K9"}) (place "Ma2" {"H11" "K8"}) (place "Ju2" {"G11" "K7"}) (place "Pao2" {"G10" "J7"}) (place "Zu2" {"F10" "G9" "H8" "I7" "J6"})}) (play (do (forEach Piece) ifAfterwards:(and (if (= (column of:(where "Jiang" P1)) (column of:(where "Jiang" P2))) (not (= (count Sites in:(forEach (sites Direction from:(where "Jiang" P1) N stop:(= (to) (where "Jiang" P2))) if:(is Occupied (site)))) 0)) True) (not (is Threatened (id "Jiang" Mover)))))) (end {(if (and (is Threatened (id "Jiang" Next)) (not (can Move (do (forEach Piece Next) ifAfterwards:(not (is Threatened (id "Jiang" Next))))))) (result Mover Win)) (if (no Moves Next) (result Mover Win))}))) 