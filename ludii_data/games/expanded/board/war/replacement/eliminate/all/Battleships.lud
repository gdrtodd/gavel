(game "Battleships" (players 2) (equipment {(board (rectangle 10 20)) (piece "Carrier" Each) (tile "CarrierTemplate" Each {{F F F F} {L F F F F}} (move (from if:(is In (from) (sites Hand Mover))) (to (intersection (sites Mover "Defence") (sites Empty))) (then (do (forEach Site (sites LargePiece at:(last To)) (remember Value (site)) (then (remove (last To)))) next:(do (forEach Value (values Remembered) (add (piece (id "Carrier" Mover)) (to (value)) (then (set State at:(last To) 0)))) next:(forget Value All)))))) (piece "Battleship" Each) (tile "BattleshipTemplate" Each {{F F F} {L F F F}} (move (from if:(is In (from) (sites Hand Mover))) (to (intersection (sites Mover "Defence") (sites Empty))) (then (do (forEach Site (sites LargePiece at:(last To)) (remember Value (site)) (then (remove (last To)))) next:(do (forEach Value (values Remembered) (add (piece (id "Battleship" Mover)) (to (value)) (then (set State at:(last To) 0)))) next:(forget Value All)))))) (piece "Destroyer" Each) (tile "DestroyerTemplate" Each {{F F} {L F F}} (move (from if:(is In (from) (sites Hand Mover))) (to (intersection (sites Mover "Defence") (sites Empty))) (then (do (forEach Site (sites LargePiece at:(last To)) (remember Value (site)) (then (remove (last To)))) next:(do (forEach Value (values Remembered) (add (piece (id "Destroyer" Mover)) (to (value)) (then (set State at:(last To) 0)))) next:(forget Value All)))))) (piece "Submarine" Each) (tile "SubmarineTemplate" Each {{F F} {L F F}} (move (from if:(is In (from) (sites Hand Mover))) (to (intersection (sites Mover "Defence") (sites Empty))) (then (do (forEach Site (sites LargePiece at:(last To)) (remember Value (site)) (then (remove (last To)))) next:(do (forEach Value (values Remembered) (add (piece (id "Submarine" Mover)) (to (value)) (then (set State at:(last To) 0)))) next:(forget Value All)))))) (piece "PatrolBoat" Each) (tile "PatrolBoatTemplate" Each {{F} {L F}} (move (from if:(is In (from) (sites Hand Mover))) (to (intersection (sites Mover "Defence") (sites Empty))) (then (do (forEach Site (sites LargePiece at:(last To)) (remember Value (site)) (then (remove (last To)))) next:(do (forEach Value (values Remembered) (add (piece (id "PatrolBoat" Mover)) (to (value)) (then (set State at:(last To) 0)))) next:(forget Value All)))))) (regions "Defence" P1 (expand (sites Left) steps:9)) (regions "Defence" P2 (expand (sites Right) steps:9)) (hand Each size:5)}) (rules (start {(set Hidden (sites P1 "Defence") to:P2) (set Hidden (sites P2 "Defence") to:P1) (set Hidden (sites Hand P1) to:P2) (set Hidden (sites Hand P2) to:P1) (place "CarrierTemplate1" (handSite P1 0)) (place "CarrierTemplate2" (handSite P2 0)) (place "BattleshipTemplate1" (handSite P1 1)) (place "BattleshipTemplate2" (handSite P2 1)) (place "DestroyerTemplate1" (handSite P1 2)) (place "DestroyerTemplate2" (handSite P2 2)) (place "SubmarineTemplate1" (handSite P1 3)) (place "SubmarineTemplate2" (handSite P2 3)) (place "PatrolBoatTemplate1" (handSite P1 4)) (place "PatrolBoatTemplate2" (handSite P2 4))}) phases:{(phase "Setup" (play (forEach Piece container:(mover))) (nextPhase (>= (count Turns) 10) "Playing")) (phase "Playing" (play (move Select (from (intersection (sites Next "Defence") (sites Hidden to:Mover))) (then (set State at:(last From) 1 (then (set Hidden at:(last From) False to:Mover (then (if (and (>= (count Turns) 10) (= 0 (count Sites in:(intersection (sites Hidden to:Mover) (sites Occupied by:Next))))) (set Var (id Mover) (then (forEach Site (sites Board) (set Hidden at:(site) False to:Next)))))))))))))} (end {(if (= (id P1) (var)) (result P1 Win)) (if (= (id P2) (var)) (result P2 Win))}))) 