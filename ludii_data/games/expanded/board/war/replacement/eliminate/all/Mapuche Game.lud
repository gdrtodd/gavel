(game "Mapuche Game" (players 2) (equipment {(board (remove (concentric {26}) vertices:{0 1 2 3 4}) {(track "TrackCW1" {0 2 4 6 8 10 12 14 16 18 20 19 17 15 13 11 9 7 5 3 1} P1 directed:True) (track "TrackCCW1" {1 3 5 7 9 11 13 15 17 19 20 18 16 14 12 10 8 6 4 2 0} P1 directed:True) (track "TrackCW2" {0 2 4 6 8 10 12 14 16 18 20 19 17 15 13 11 9 7 5 3 1} P2 directed:True) (track "TrackCCW2" {1 3 5 7 9 11 13 15 17 19 20 18 16 14 12 10 8 6 4 2 0} P2 directed:True)} use:Vertex) (regions "AllSitesExceptTop" (difference (sites Board) 20)) (piece "Marker" Each (if (!= (if (= 0 (state at:(from))) (trackSite Move "TrackCW" steps:(mapEntry "ThrowDiceValue" (count Pips))) (trackSite Move "TrackCCW" steps:(mapEntry "ThrowDiceValue" (count Pips)))) -1) (if (or (is In (if (= 0 (state at:(from))) (trackSite Move "TrackCW" steps:(mapEntry "ThrowDiceValue" (count Pips))) (trackSite Move "TrackCCW" steps:(mapEntry "ThrowDiceValue" (count Pips)))) (sites Empty)) (is Enemy (who at:(if (= 0 (state at:(from))) (trackSite Move "TrackCW" steps:(mapEntry "ThrowDiceValue" (count Pips))) (trackSite Move "TrackCCW" steps:(mapEntry "ThrowDiceValue" (count Pips))))))) (move (from) (to (if (= 0 (state at:(from))) (trackSite Move "TrackCW" steps:(mapEntry "ThrowDiceValue" (count Pips))) (trackSite Move "TrackCCW" steps:(mapEntry "ThrowDiceValue" (count Pips)))) (apply if:(is Enemy (who at:(to))) (remove (to)))))))) (dice d:2 from:0 num:4) (map "ThrowDiceValue" {(pair 0 4) (pair 1 0) (pair 2 2) (pair 3 0) (pair 4 3)}) (hand Each)}) (rules (start {(place "Marker1" (sites {0 2 4 6 8 10 12 14 16 18})) (place "Marker2" (sites {1 3 5 7 9 11 13 15 17 19}) state:1)}) (play (do (roll) next:(if (can Move (if (!= (mapEntry "ThrowDiceValue" (count Pips)) 0) (forEach Piece))) (forEach Piece (then (if (!= (mapEntry "ThrowDiceValue" (count Pips)) 0) (moveAgain)))) (move Pass (then (if (!= (mapEntry "ThrowDiceValue" (count Pips)) 0) (moveAgain))))) (then (and (if (and (is Occupied 20) (!= 20 (last To))) (remove 20)) (if (= (last To) (if (= 0 (state at:(last To))) (trackSite EndSite Mover "TrackCW") (trackSite EndSite Mover "TrackCCW"))) (if (= 0 (state at:(last To))) (set State at:(last To) 1) (set State at:(last To) 0))))))) (end {(if (no Pieces P1) (result P1 Loss)) (if (no Pieces P2) (result P2 Loss))}))) 