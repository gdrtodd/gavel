(game "Allemande" (players 2) (equipment {(board (remove (square (+ 2 7)) cells:{0 (+ 7 1) (* (+ 7 2) (+ 7 1)) (- (^ (+ 7 2) 2) 1)}) use:Cell) (regions "EW" P1 (union (sites Column (+ 7 1)) (sites Column 0))) (regions "NS" P2 (union (sites Row (+ 7 1)) (sites Row 0))) (piece "Square" Each) (hand Each size:4)}) (rules (start {(place "Square1" (union (sites Column (+ 7 1)) (sites Column 0))) (place "Square2" (union (sites Row (+ 7 1)) (sites Row 0)))}) (play (if (not (is Prev Mover)) (do (or {(move Add (piece (id "Square" Mover)) (to (sites Empty)) (then (if (not (is Prev Mover)) (remember Value (last To))))) (move Select (from Edge (sites Board Edge) if:(no Pieces All in:(sites Incident Cell of:Edge at:(from)))) (then (forEach Site (sites Incident Cell of:Edge at:(last From)) (and (add (piece (id "Square" Mover)) (to (site))) (if (not (is Prev Mover)) (remember Value (site))))))) (if (is Prev Mover) (move Pass))}) ifAfterwards:(or {(= (size Array (sizes Group Orthogonal Mover)) (size Array (sizes Group All Mover))) (can Move (do (or {(move Add (piece (id "Square" Mover)) (to Cell (intersection (sites Around (sites (values Remembered)) Orthogonal) (sites Empty)))) (move Select (from Edge (forEach of:(intersection (sites Around (sites (values Remembered)) Orthogonal) (sites Empty)) (sites Incident Edge of:Cell at:(site))) if:(no Pieces All in:(sites Incident Cell of:Edge at:(from)))) (then (add (piece (id "Square" Mover)) (to Cell (sites Incident Cell of:Edge at:(last From))))))}) ifAfterwards:(= (size Array (sizes Group Orthogonal Mover)) (size Array (sizes Group All Mover)))))}) (then (moveAgain))) (do (or {(move Add (piece (id "Square" Mover)) (to Cell (intersection (sites Around (sites (values Remembered)) Orthogonal) (sites Empty)))) (move Select (from Edge (forEach of:(intersection (sites Around (sites (values Remembered)) Orthogonal) (sites Empty)) (sites Incident Edge of:Cell at:(site))) if:(no Pieces All in:(sites Incident Cell of:Edge at:(from)))) (then (add (piece (id "Square" Mover)) (to Cell (sites Incident Cell of:Edge at:(last From))))))}) ifAfterwards:(= (size Array (sizes Group Orthogonal Mover)) (size Array (sizes Group All Mover))) (then (forget Value All))))) (end (if (or (is Connected at:(regionSite (sites Column Cell 0) index:0) Orthogonal {(sites Column (+ 7 1)) (sites Column 0)}) (is Connected at:(regionSite (sites Row Cell 0) index:0) Orthogonal {(sites Row (+ 7 1)) (sites Row 0)})) (result Mover Win))))) 