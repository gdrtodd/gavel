(game "Watershed" (players 2) (equipment {(board (square 9) use:Vertex) (piece "Ball" Each) (piece "Disc" Each) (hand Each size:1)}) (rules (start (set Score Each 0)) (play (do (move Add (to (sites Empty) if:(< 1 (count Sites in:(intersection (sites Around (to) All) (sites Empty)))))) ifAfterwards:(all Sites (intersection (sites Around (last To) All) (sites Empty)) if:(or (and (is Empty (site)) (is In (site) (sites Outer))) (!= 1000000000 (count Steps (step All (to if:(is Empty (to)))) (site) (difference (sites Outer) (site)))))) (then (do (forEach Value (array (intersection (sites Occupied by:All) (sites Around (last To) All))) (if (> 2 (count Sites in:(sites Around (value) All if:(is Empty (to))))) (if (is Next (who at:(value))) (remove (value) (then (if (is Empty (handSite Mover)) (add (piece (id "Disc" Next)) (to (handSite Mover)) (then (set Value at:(handSite Mover) (+ 1 (value Piece at:(handSite Mover)))))) (set Value at:(handSite Mover) (+ 1 (value Piece at:(handSite Mover))))))) (remove (value))))) next:(set Var "MoverScore" (+ (value Piece at:(handSite Mover)) (max 0 (max (sizes Group Orthogonal Mover)))) (then (set Var "NextScore" (+ (value Piece at:(handSite Next)) (max 0 (max (sizes Group Orthogonal Next)))) (then (if (= (var "MoverScore") (var "NextScore")) (and (set Score Mover (* -1 (max 0 (max (difference (sizes Group Orthogonal Mover) (sizes Group Orthogonal Next)))))) (set Score Next (* -1 (max 0 (max (difference (sizes Group Orthogonal Next) (sizes Group Orthogonal Mover))))))) (and (set Score Mover (var "MoverScore")) (set Score Next (var "NextScore")))))))))))) (end (if (no Moves Next) {(if (= (score Mover) (score Next)) (result Mover Win)) (if (!= (score Mover) (score Next)) (byScore))})))) 