(game "Windflowers" (players 2) (equipment {(board (tiling T33434 (- 4 2)) use:Vertex) (piece "Ball" Each)}) (rules (start (set Score Each 0)) (play (or {(move Pass) (move Claim (to (sites Empty))) (forEach Site (difference (difference (sites Board) (sites Empty)) (sites Occupied by:Mover)) (if (> (max 0 (count Pieces of:(who at:(site)) in:(sites Around (site) All))) (max 0 (count Pieces of:(mover) in:(sites Around (site) All)))) (move Remove (site) (then (claim (to (last To)))))))} (then (if (all Passed) (do (forEach Player (remember Value "Scores" (count Sites in:(sites Occupied by:Player)))) next:(do (forEach Player (if (= (count Sites in:(sites Occupied by:Player)) (max (difference (values Remembered "Scores") (count Sites in:(sites Occupied by:Player))))) (and (remember Value "Tied" (player)) (set Score Player (count Sites in:(sites Occupied by:Player)))) (set Score Player (count Sites in:(sites Occupied by:Player))))) next:(do (forEach Value (values Remembered "Tied") (forEach (players All if:(is In (player) (values Remembered "Tied"))) (addScore (player (player)) (max 0 (- (max 0 (max (difference (sizes Group Adjacent of:(value)) (sizes Group Adjacent of:(player))))) (max 0 (max (difference (sizes Group Adjacent of:(player)) (sizes Group Adjacent of:(value)))))))))) next:(forget Value "Scores" All (then (forget Value "Tied" All)))))) (forEach Player (set Score Player (count Sites in:(sites Occupied by:Player)))))))) (end (if (all Passed) (byScore))))) 