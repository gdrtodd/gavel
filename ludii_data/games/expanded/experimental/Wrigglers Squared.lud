(game "Wrigglers Squared" (players 2) (equipment {(board (square 9) use:Vertex) (piece "Disc" Each)}) (rules (play (if (= 1 (var "Added")) (or {(or {(move Add (piece (id "Disc" Mover)) (to (sites Empty) if:(> 3 (count Pieces Mover in:(sites Around (to) Orthogonal)))) (then (set Var "Added" 1))) (move Pass)}) (forEach Piece (if (< 2 (count Pieces Mover in:(sites Around (from) Orthogonal))) (move Remove (from) (then (set Var "Added" 0)))) Mover)}) (or {(move Add (piece (id "Disc" Mover)) (to (sites Empty) if:(> 3 (count Pieces Mover in:(sites Around (to) Orthogonal)))) (then (set Var "Added" 1))) (move Pass)}) (then (do (forEach Site (sites Occupied by:Mover) (if (> 3 (count Pieces Mover in:(sites Around (site) Orthogonal))) (set State at:(site) 0) (set State at:(site) 1))) next:(do (and {(remember Value 0) (remember Value 0) (forEach Group Orthogonal (if (no Pieces in:(intersection (sites) (sites State 1))) (remember Value (count Sites in:(sites)))))}) next:(set Var "TopValue" (max (values Remembered)) (then (forget Value (max (values Remembered)) (then (set Score Mover (* (var "TopValue") (max (values Remembered))) (then (forget Value All)))))))))))) (end (if (all Passed) {(if (>= (score Mover) (score Next)) (result Mover Win))} (result Next Win))))) 