(game "Mastermind" (players 2) (equipment {(board (merge {(rectangle (+ 1 12) 4) (shift 4 0.75 (repeat 12 1 step:{{1 0} {0 1}} (poly {{0 0} {0 0.5} {0.5 0.5} {0.5 0}})))}) use:Vertex) (piece "Marker1" Shared) (piece "Marker2" Shared) (piece "Marker3" Shared) (piece "Marker4" Shared) (piece "Marker5" Shared) (piece "Marker6" Shared) (piece "Marker7" Shared) (piece "Marker8" Shared) (piece "Disc1" Shared) (piece "Disc2" Shared) (hand Shared size:8)}) (rules (start {(place "Marker1" (handSite Shared)) (place "Marker2" (handSite Shared 1)) (place "Marker3" (handSite Shared 2)) (place "Marker4" (handSite Shared 3)) (place "Marker5" (handSite Shared 4)) (place "Marker6" (handSite Shared 5)) (place "Marker7" (handSite Shared 6)) (place "Marker8" (handSite Shared 7))}) phases:{(phase "Placement" P1 (play (move (from (sites Hand Shared)) (to (intersection (sites Empty) (sites Bottom))) copy:True (then (and {(set Hidden at:(last To) to:P2) (if (= 0 (count Sites in:(intersection (sites Empty) (sites Bottom)))) (set Var 0) (moveAgain))}))))) (phase "Finding" P2 (play (move (from (sites Hand Shared)) (to (intersection (sites Empty) (sites Row (- (+ 2 (* 3 (- 12 1))) (* 3 (var)))))) copy:True (then (and (moveAgain) (if (= 0 (count Sites in:(intersection (sites Empty) (sites Row (- (+ 2 (* 3 (- 12 1))) (* 3 (var))))))) (and (forEach Value min:0 max:(- 4 1) (if (= (what at:(regionSite (sites Row (- (+ 2 (* 3 (- 12 1))) (* 3 (var)))) index:(value))) (what at:(coord row:0 column:(value)))) (add (piece "Disc2") (to (regionSite (union (sites Row (+ (- (+ 2 (* 3 (- 12 1))) (* 3 (var))) 1)) (sites Row (- (- (+ 2 (* 3 (- 12 1))) (* 3 (var))) 1))) index:(value)))) (if (is In (what at:(regionSite (sites Bottom) index:(value))) (results from:(sites Row (- (+ 2 (* 3 (- 12 1))) (* 3 (var)))) to:0 (what at:(from)))) (add (piece "Disc1") (to (regionSite (union (sites Row (+ (- (+ 2 (* 3 (- 12 1))) (* 3 (var))) 1)) (sites Row (- (- (+ 2 (* 3 (- 12 1))) (* 3 (var))) 1))) index:(value))))))) (set Var (+ 1 (var))) (then (if (or (and (= 0 (count Sites in:(intersection (sites Empty) (sites Row (- (+ 2 (* 3 (- 12 1))) (* 3 (- (var) 1))))))) (= 4 (count Sites in:(forEach (sites Row (- (+ 2 (* 3 (- 12 1))) (* 3 (- (var) 1)))) if:(= (what at:(site)) (what at:(coord row:0 column:(column of:(site))))))))) (>= (var) 12)) (forEach Site (sites Bottom) (set Hidden at:(site) False to:P2)))))))))) (end {(if (and (= 0 (count Sites in:(intersection (sites Empty) (sites Row (- (+ 2 (* 3 (- 12 1))) (* 3 (- (var) 1))))))) (= 4 (count Sites in:(forEach (sites Row (- (+ 2 (* 3 (- 12 1))) (* 3 (- (var) 1)))) if:(= (what at:(site)) (what at:(coord row:0 column:(column of:(site))))))))) (result P2 Win)) (if (>= (var) 12) (result P1 Win))}))})) 