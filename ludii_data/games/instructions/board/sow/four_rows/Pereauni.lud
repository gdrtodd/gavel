4x8 board. Two counters in each hole. Opening play: Two players play simultaneously, lifting and sowing counters from their outer rows. Rules for sowing and capturing are the same as in the main phase of the game except that all holes in each player's outer rows are considered to be in opposition and back captures can be made from them. Once a counter has been sown into the inner row, this ceases and captures can only be made from the inner row. The opening ends when both players reach an empty hole, and the first player to do so begins play in the main phase. Main phase: Play begins from any hole on the player's side of the board with counters in it. Singletons cannot move. Sowing happens in an anti-clockwise direction. If the last counter lands in an empty hole, the turn is over. For capturing: four holes are in opposition when one player has the front row hole occupied and the opponent has both of the holes opposite it occupied. If the last hole in a sowing is in opposition, the player takes the counters in both of the opponent's holes and places them in the empty hole from which the player lifted the counters. The player then sows the captured counters from this hole. Further captures in the sowing can occur in the same way. If the last counter lands on a hole that is occupied but not in opposition, these counters are picked up and sowing continues. Play ends when one player captures all the opponent's counters or one player cannot play. The player who cannot play loses. Each row has 8 holes.
(game "Pereauni" (players 2) (equipment {(mancalaBoard 4 8 store:None {(track "TrackCCW1" "0,E,N1,W" loop:True P1) (track "TrackCCW2" "16,E,N1,W" loop:True P2)}) (regions "Home" P1 (sites Track "TrackCCW1")) (regions "Home" P2 (sites Track "TrackCCW2")) (regions "Inner" P1 (difference (sites Track "TrackCCW1") (sites Bottom))) (regions "Inner" P2 (difference (sites Track "TrackCCW2") (sites Top))) (regions "Outer" P1 (sites Bottom)) (regions "Outer" P2 (sites Top)) (piece "Seed" Shared)}) (rules (start (set Count 2 to:(union (sites P1 "Home") (sites P2 "Home")))) phases:{(phase "OuterPhase" (play (move Select (from (if (is Prev Mover) (sites {(var "Replay")}) (sites Mover "Outer")) if:(if (is Prev Mover) (lt 0 (count at:(from))) (lt 1 (count at:(from))))) (then (sow count:(if (is Prev Mover) (var "Count") (count at:(last From))) "TrackCCW" owner:(mover) apply:(and (if (lt 1 (count at:(to))) (and (moveAgain) (if (and (is Occupied (if (is Mover P1) (add (to) 8) (sub (to) 8))) (is In (to) (sites Mover "Inner"))) (and {(fromTo (from (if (is Mover P1) (add (to) 8) (sub (to) 8))) (to (if (is Mover P1) (sub (to) 8) (add (to) 8))) count:(count at:(if (is Mover P1) (add (to) 8) (sub (to) 8)))) (if (is Occupied (if (is Mover P1) (add (to) (mul 8 2)) (sub (to) (mul 8 2)))) (fromTo (from (if (is Mover P1) (add (to) (mul 8 2)) (sub (to) (mul 8 2)))) (to (if (is Mover P1) (sub (to) 8) (add (to) 8))) count:(count at:(if (is Mover P1) (add (to) (mul 8 2)) (sub (to) (mul 8 2)))))) (set Var "Replay" (if (is Mover P1) (sub (to) 8) (add (to) 8))) (if (equals 1 (count at:(if (is Mover P1) (sub (to) 8) (add (to) 8)))) (set Var "Count" (add {1 (count at:(if (is Mover P1) (add (to) 8) (sub (to) 8))) (count at:(if (is Mover P1) (add (to) (mul 8 2)) (sub (to) (mul 8 2))))})) (set Var "Count" (add (count at:(if (is Mover P1) (add (to) 8) (sub (to) 8))) (count at:(if (is Mover P1) (add (to) (mul 8 2)) (sub (to) (mul 8 2)))))))}) (and (set Var "Replay" (to)) (set Var "Count" (count at:(to))))))) (if (notEqual 1 (value Player Mover)) (set Value Mover 1))))))) (nextPhase Mover (equals 1 (count at:(last To afterConsequence:True))) "MainPhase")) (phase "MainPhase" (play (move Select (from (if (is Prev Mover) (sites {(var "Replay")}) (sites Mover)) if:(if (is Prev Mover) (lt 0 (count at:(from))) (lt 1 (count at:(from))))) (then (sow count:(if (is Prev Mover) (var "Count") (count at:(last From))) "TrackCCW" owner:(mover) apply:(if (lt 1 (count at:(to))) (and (moveAgain) (if (and {(is Occupied (if (is Mover P1) (add (to) 8) (sub (to) 8))) (is In (to) (sites Mover "Inner"))}) (and {(fromTo (from (if (is Mover P1) (add (to) 8) (sub (to) 8))) (to (if (is Mover P1) (sub (to) 8) (add (to) 8))) count:(count at:(if (is Mover P1) (add (to) 8) (sub (to) 8)))) (if (is Occupied (if (is Mover P1) (add (to) (mul 8 2)) (sub (to) (mul 8 2)))) (fromTo (from (if (is Mover P1) (add (to) (mul 8 2)) (sub (to) (mul 8 2)))) (to (if (is Mover P1) (sub (to) 8) (add (to) 8))) count:(count at:(if (is Mover P1) (add (to) (mul 8 2)) (sub (to) (mul 8 2)))))) (set Var "Replay" (if (is Mover P1) (sub (to) 8) (add (to) 8))) (if (equals 1 (count at:(if (is Mover P1) (sub (to) 8) (add (to) 8)))) (set Var "Count" (add {1 (count at:(if (is Mover P1) (add (to) 8) (sub (to) 8))) (count at:(if (is Mover P1) (add (to) (mul 8 2)) (sub (to) (mul 8 2))))})) (set Var "Count" (add (count at:(if (is Mover P1) (add (to) 8) (sub (to) 8))) (count at:(if (is Mover P1) (add (to) (mul 8 2)) (sub (to) (mul 8 2)))))))}) (and (set Var "Replay" (to)) (set Var "Count" (count at:(to))))))))))))} (end (if (no Moves Next) (result Mover Win))))) 
