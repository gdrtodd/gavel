2x7 board with two stores. Four counters in each hole. Sowing occurs in either a clockwise or anti-clockwise direction; the first player chooses the direction and all subsequent moves are made in that direction. Players sow beginning from holes in their row. If the last counter falls into a hole with counters, the counters in the next hole are picked up and sowing continues, and if this hole is empty, the counters in the hole following the empty hole are captured. If there is an unbroken sequence of alternating empty and occupied holes, the counters in the occupied holes are captured until there are two empty or two occupied holes. If the final counter falls into an empty hole the turn ends. Throughout the game, singletons cannot be moved is a player has a hole with multiple counters, and a singleton in the front hole cannot be moved if there are other singletons in the player's row. The round ends when one player's holes are empty. A second round begins with the winner of the first round placing four counters in each of their holes, leaving any surplus in the store. The loser of round one places four counters in as many consecutive holes on their side of the board as possible, and any remaining counters in the next hole. If this hole contains one, it is called puta, if two, naga, if three, wala. Holes with no counters are excluded from play for this round. If the loser has a puta hole, the opponent removes three counters from their hole opposite; if a naga, the opponent removes two from the opposite hole, if a wala, the opponent removes one. The removed counters go into their store. Puta and naga holes are marked with a piece of paper or straw in them. Empty holes are excluded from play in this round. The losing player begins the round, moving in the direction of the excluded holes, and played in the same way as the first round. The player with empty holes begins play in the direction of the empty hole. Counters cannot be captured or sowed from puta or naga holes. Play continues as before. When one player has fewer than twelve counters at the beginning of a round, they may arrange them differently at the beginning. They may put one or two counters in one end hole and not more than four in the other end hole, and one or two counters in the intermediate holes, leaving some empty and, thus, excluded. The opponent then puts four counters in each of their holes. There are no puta, naga, or wala holes in this round. The player with more counters plays as before, but the one with less has captures that are determined by the number of counters placed in the first end hole. If there were two in the end hole, the player captures when dropping the final counter into a hole to make it three; or when it makes two if there was one counter in the first end hole. Otherwise, the player does not sow in holes with one or two counters. Play continues until one player cannot sow at the beginning of a round.
(game "Walak-Pussa" (players 2) (equipment {(mancalaBoard 2 7 {(track "TrackCCW" "1,E,N,W" loop:True) (track "TrackCW" "7,W,N,E" loop:True)}) (piece "Seed" Shared) (regions P1 (sites Bottom)) (regions P2 (sites Top)) (map {(pair P1 FirstSite) (pair P2 LastSite)})}) (rules (start {(set Count 4 to:(sites Track)) (set RememberValue "Playable" (union (sites Top) (sites Bottom)))}) phases:{(phase "StartingMove" (play (or (move Select (from (sites Mover) if:(and (is Occupied (from)) (is In (from) (sites (values Remembered "Playable"))))) (then (and (sow "TrackCCW" apply:(if (equals 1 (count at:(to))) (if (lt 0 (count at:(trackSite Move from:(to) "TrackCCW" steps:1))) (and (fromTo (from (trackSite Move from:(to) "TrackCCW" steps:1)) (to (mapEntry Mover)) count:(count at:(trackSite Move from:(to) "TrackCCW" steps:1))) (if (and (equals 0 (count at:(trackSite Move from:(to) "TrackCCW" steps:2))) (lt 0 (count at:(trackSite Move from:(to) "TrackCCW" steps:3)))) (and (fromTo (from (trackSite Move from:(to) "TrackCCW" steps:3)) (to (mapEntry Mover)) count:(count at:(trackSite Move from:(to) "TrackCCW" steps:3))) (if (and (equals 0 (count at:(trackSite Move from:(to) "TrackCCW" steps:4))) (lt 0 (count at:(trackSite Move from:(to) "TrackCCW" steps:5)))) (and (fromTo (from (trackSite Move from:(to) "TrackCCW" steps:5)) (to (mapEntry Mover)) count:(count at:(trackSite Move from:(to) "TrackCCW" steps:5))) (if (and (equals 0 (count at:(trackSite Move from:(to) "TrackCCW" steps:6))) (lt 0 (count at:(trackSite Move from:(to) "TrackCCW" steps:7)))) (fromTo (from (trackSite Move from:(to) "TrackCCW" steps:7)) (to (mapEntry Mover)) count:(count at:(trackSite Move from:(to) "TrackCCW" steps:7)))))))))) (and (moveAgain) (set Var "Replay" (to)))) skipIf:(not (is In (to) (sites (values Remembered "Playable"))))) (set Var "Direction" 1)))) (move Select (from (sites Mover) if:(and (is Occupied (from)) (is In (from) (sites (values Remembered "Playable"))))) (then (and (sow "TrackCW" apply:(if (equals 1 (count at:(to))) (if (lt 0 (count at:(trackSite Move from:(to) "TrackCW" steps:1))) (and (fromTo (from (trackSite Move from:(to) "TrackCW" steps:1)) (to (mapEntry Mover)) count:(count at:(trackSite Move from:(to) "TrackCW" steps:1))) (if (and (equals 0 (count at:(trackSite Move from:(to) "TrackCW" steps:2))) (lt 0 (count at:(trackSite Move from:(to) "TrackCW" steps:3)))) (and (fromTo (from (trackSite Move from:(to) "TrackCW" steps:3)) (to (mapEntry Mover)) count:(count at:(trackSite Move from:(to) "TrackCW" steps:3))) (if (and (equals 0 (count at:(trackSite Move from:(to) "TrackCW" steps:4))) (lt 0 (count at:(trackSite Move from:(to) "TrackCW" steps:5)))) (and (fromTo (from (trackSite Move from:(to) "TrackCW" steps:5)) (to (mapEntry Mover)) count:(count at:(trackSite Move from:(to) "TrackCW" steps:5))) (if (and (equals 0 (count at:(trackSite Move from:(to) "TrackCW" steps:6))) (lt 0 (count at:(trackSite Move from:(to) "TrackCW" steps:7)))) (fromTo (from (trackSite Move from:(to) "TrackCW" steps:7)) (to (mapEntry Mover)) count:(count at:(trackSite Move from:(to) "TrackCW" steps:7)))))))))) (and (moveAgain) (set Var "Replay" (to)))) skipIf:(not (is In (to) (sites (values Remembered "Playable"))))) (set Var "Direction" 2)))))) (nextPhase "Sowing")) (phase "Sowing" (play (if (equals 1 (var "Direction")) (move Select (from (if (and (not (is Pending)) (is Prev Mover)) (sites {(var "Replay")}) (sites Mover)) if:(and {(is Occupied (from)) (is In (from) (sites (values Remembered "Playable"))) (not (is In (from) (sites (values Remembered "Blocked")))) (if (not (all Sites (forEach (sites Mover) if:(is In (site) (sites (values Remembered "Playable")))) if:(ge 1 (count at:(site))))) (lt 1 (count at:(from))))})) (then (sow "TrackCCW" apply:(if (equals 1 (count at:(to))) (if (lt 0 (count at:(trackSite Move from:(to) "TrackCCW" steps:1))) (and (fromTo (from (trackSite Move from:(to) "TrackCCW" steps:1)) (to (mapEntry Mover)) count:(count at:(trackSite Move from:(to) "TrackCCW" steps:1))) (if (and (equals 0 (count at:(trackSite Move from:(to) "TrackCCW" steps:2))) (lt 0 (count at:(trackSite Move from:(to) "TrackCCW" steps:3)))) (and (fromTo (from (trackSite Move from:(to) "TrackCCW" steps:3)) (to (mapEntry Mover)) count:(count at:(trackSite Move from:(to) "TrackCCW" steps:3))) (if (and (equals 0 (count at:(trackSite Move from:(to) "TrackCCW" steps:4))) (lt 0 (count at:(trackSite Move from:(to) "TrackCCW" steps:5)))) (and (fromTo (from (trackSite Move from:(to) "TrackCCW" steps:5)) (to (mapEntry Mover)) count:(count at:(trackSite Move from:(to) "TrackCCW" steps:5))) (if (and (equals 0 (count at:(trackSite Move from:(to) "TrackCCW" steps:6))) (lt 0 (count at:(trackSite Move from:(to) "TrackCCW" steps:7)))) (fromTo (from (trackSite Move from:(to) "TrackCCW" steps:7)) (to (mapEntry Mover)) count:(count at:(trackSite Move from:(to) "TrackCCW" steps:7)))))))))) (and (moveAgain) (set Var "Replay" (to)))) skipIf:(not (is In (to) (sites (values Remembered "Playable"))))))) (move Select (from (if (and (not (is Pending)) (is Prev Mover)) (sites {(var "Replay")}) (sites Mover)) if:(and {(is Occupied (from)) (is In (from) (sites (values Remembered "Playable"))) (not (is In (from) (sites (values Remembered "Blocked")))) (if (not (all Sites (forEach (sites Mover) if:(is In (site) (sites (values Remembered "Playable")))) if:(ge 1 (count at:(site))))) (lt 1 (count at:(from))))})) (then (sow "TrackCW" apply:(if (equals 1 (count at:(to))) (if (lt 0 (count at:(trackSite Move from:(to) "TrackCW" steps:1))) (and (fromTo (from (trackSite Move from:(to) "TrackCW" steps:1)) (to (mapEntry Mover)) count:(count at:(trackSite Move from:(to) "TrackCW" steps:1))) (if (and (equals 0 (count at:(trackSite Move from:(to) "TrackCW" steps:2))) (lt 0 (count at:(trackSite Move from:(to) "TrackCW" steps:3)))) (and (fromTo (from (trackSite Move from:(to) "TrackCW" steps:3)) (to (mapEntry Mover)) count:(count at:(trackSite Move from:(to) "TrackCW" steps:3))) (if (and (equals 0 (count at:(trackSite Move from:(to) "TrackCW" steps:4))) (lt 0 (count at:(trackSite Move from:(to) "TrackCW" steps:5)))) (and (fromTo (from (trackSite Move from:(to) "TrackCW" steps:5)) (to (mapEntry Mover)) count:(count at:(trackSite Move from:(to) "TrackCW" steps:5))) (if (and (equals 0 (count at:(trackSite Move from:(to) "TrackCW" steps:6))) (lt 0 (count at:(trackSite Move from:(to) "TrackCW" steps:7)))) (fromTo (from (trackSite Move from:(to) "TrackCW" steps:7)) (to (mapEntry Mover)) count:(count at:(trackSite Move from:(to) "TrackCW" steps:7)))))))))) (and (moveAgain) (set Var "Replay" (to)))) skipIf:(not (is In (to) (sites (values Remembered "Playable"))))))) (then (if (no Moves Next) (and {(forEach Site (sites P1) (if (is Occupied (site)) (fromTo (from (site)) (to (mapEntry P1)) count:(count at:(site))))) (forEach Site (sites P2) (if (is Occupied (site)) (fromTo (from (site)) (to (mapEntry P2)) count:(count at:(site))))) (forget Value "Playable" All) (forget Value "Blocked" All) (if (lt (add (count at:(mapEntry P1)) (count in:(sites P1))) (add (count at:(mapEntry P2)) (count in:(sites P2)))) (and (set NextPlayer (player 2)) (set Var "Winner" 2)) (and (set NextPlayer (player 1)) (set Var "Winner" 1)))}))))) (end (if (no Moves Next) {(if (gt 2 (count at:(mapEntry P1))) (result P2 Win)) (if (gt 2 (count at:(mapEntry P2))) (result P1 Win))})) (nextPhase (no Moves Next) "BetweenRounds")) (phase "BetweenRounds" (play (if (and (not (is Prev Mover)) (notEqual (mover) (var "Winner"))) (or (move (from (mapEntry Mover)) (to (if (is Mover P1) (intersection (sites Bottom) (expand (sites Right))) (intersection (sites Top) (expand (sites Left)))) if:(is Empty (to))) count:(min 4 (count at:(mapEntry Mover))) (then (and {(remember Value "Playable" (last To)) (if (gt 4 (count at:(last To))) (and (fromTo (from (if (is Mover P1) (add (to) 7) (sub (to) 7))) (to (mapEntry Next)) count:(sub 4 (count at:(last To)))) (remember Value "Blocked" (last To)))) (moveAgain) (if (equals 0 (count at:(mapEntry Mover))) (set Pending)) (set Var "Direction" 2)}))) (move (from (mapEntry Mover)) (to (if (is Mover P1) (intersection (sites Bottom) (expand (sites Left))) (intersection (sites Top) (expand (sites Right)))) if:(is Empty (to))) count:(min 4 (count at:(mapEntry Mover))) (then (and {(remember Value "Playable" (last To)) (if (gt 4 (count at:(last To))) (and (fromTo (from (if (is Mover P1) (add (to) 7) (sub (to) 7))) (to (mapEntry Next)) count:(sub 4 (count at:(last To)))) (remember Value "Blocked" (last To)))) (moveAgain) (if (equals 0 (count at:(mapEntry Mover))) (set Pending)) (set Var "Direction" 1)})))) (if (notEqual (mover) (var "Winner")) (move (from (mapEntry Mover)) (to (if (equals (var "Direction") 1) (trackSite Move from:(last To) "TrackCCW" steps:1) (trackSite Move from:(last To) "TrackCW" steps:1)) if:(is Empty (to))) count:(min 4 (count at:(mapEntry Mover))) (then (and {(remember Value "Playable" (last To)) (moveAgain) (if (equals 0 (count at:(mapEntry Mover))) (set Pending))}))) (move (from (mapEntry Mover)) (to (sites Mover) if:(is Empty (to))) count:4 (then (and (remember Value "Playable" (last To)) (if (not (all Sites (sites Mover) if:(is Occupied (site)))) (moveAgain)))))))) (nextPhase (and (notEqual (var "Winner") (mover)) (equals 0 (count at:(mapEntry Mover)))) "Sowing"))})) 
